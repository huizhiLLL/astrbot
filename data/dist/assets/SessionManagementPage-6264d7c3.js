import{u as H,ac as j,a5 as v,g as y,b as i,w as l,Q as G,o as h,M as B,N as E,A as c,t as r,k as X,e as u,al as T,$ as D,ad as S,C as p,a0 as z,P as w,aX as Z,ap as V,aq as L,ae as J,af as Y,p as x,l as P,a as k,am as C,a2 as N,L as U,B as $,F as M,h as A,V as ee,d as se,q as te,ai as I,ar as ae,Z as W,a1 as q,aE as le,aF as ie,aG as oe,aH as ne,ak as re,G as de,H as ce}from"./index-77b120c5.js";import{l as me}from"./lodash-a7a5cbfd.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const he={name:"SessionManagementPage",setup(){const{t:o}=H(),{tm:t}=j("features/session-management");return{t:o,tm:t}},data(){return{loading:!1,sessions:[],searchQuery:"",filterPlatform:null,currentPage:1,itemsPerPage:10,totalItems:0,totalPages:0,availablePersonas:[],availableChatProviders:[],availableSttProviders:[],availableTtsProviders:[],batchPersona:null,batchChatProvider:null,batchSttProvider:null,batchTtsProvider:null,batchLlmStatus:null,batchTtsStatus:null,batchUpdating:!1,pluginDialog:!1,selectedSessionForPlugin:null,sessionPlugins:[],loadingPlugins:!1,nameEditDialog:!1,selectedSessionForName:null,newSessionName:"",nameEditLoading:!1,kbDialog:!1,selectedSessionForKB:null,sessionKBConfig:{kb_ids:[],top_k:5,enable_rerank:!0},availableKBs:[],loadingKBConfig:!1,savingKBConfig:!1,snackbar:!1,snackbarText:"",snackbarColor:"success"}},computed:{messages(){return{updateSuccess:this.tm("messages.updateSuccess"),addSuccess:this.tm("messages.addSuccess"),deleteSuccess:this.tm("messages.deleteSuccess"),statusUpdateSuccess:this.tm("messages.statusUpdateSuccess"),deleteConfirm:this.tm("messages.deleteConfirm")}},subtitle(){return this.tm("subtitle")||"管理所有活跃的会话，配置人格、LLM提供商和插件"},headers(){return[{title:this.tm("table.headers.sessionStatus"),key:"session_enabled",sortable:!1,minWidth:"120px"},{title:this.tm("table.headers.sessionInfo"),key:"session_info",sortable:!1},{title:this.tm("table.headers.persona"),key:"persona",sortable:!1,minWidth:"150px"},{title:this.tm("table.headers.chatProvider"),key:"chat_provider",sortable:!1,minWidth:"200px"},{title:this.tm("table.headers.sttProvider"),key:"stt_provider",sortable:!1,minWidth:"200px"},{title:this.tm("table.headers.ttsProvider"),key:"tts_provider",sortable:!1,minWidth:"200px"},{title:this.tm("table.headers.llmStatus"),key:"llm_enabled",sortable:!1,minWidth:"120px"},{title:this.tm("table.headers.ttsStatus"),key:"tts_enabled",sortable:!1,minWidth:"120px"},{title:this.tm("table.headers.knowledgeBase"),key:"knowledge_base",sortable:!1,minWidth:"150px"},{title:this.tm("table.headers.pluginManagement"),key:"plugins",sortable:!1,minWidth:"120px"},{title:this.tm("table.headers.actions"),key:"actions",sortable:!1,minWidth:"100px"}]},platformOptions(){return[...new Set(this.sessions.map(t=>t.platform))].map(t=>({title:t,value:t}))},personaOptions(){return[{label:this.tm("persona.none"),value:"[%None]"},...this.availablePersonas.map(t=>({label:t.name,value:t.name}))]},chatProviderOptions(){return this.availableChatProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))},sttProviderOptions(){return this.availableSttProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))},ttsProviderOptions(){return this.availableTtsProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))}},mounted(){this.loadSessions()},methods:{async loadSessions(){var o,t;this.loading=!0;try{const d={page:this.currentPage,page_size:this.itemsPerPage};this.searchQuery&&(d.search=this.searchQuery),this.filterPlatform&&(d.platform=this.filterPlatform);const a=await v.get("/api/session/list",{params:d});if(a.data.status==="ok"){const s=a.data.data;this.sessions=s.sessions.map(n=>({...n,updating:!1,loadingPlugins:!1,deleting:!1,loadingKB:!1})),this.availablePersonas=s.available_personas,this.availableChatProviders=s.available_chat_providers,this.availableSttProviders=s.available_stt_providers,this.availableTtsProviders=s.available_tts_providers,s.pagination&&(this.totalItems=s.pagination.total,this.totalPages=s.pagination.total_pages,this.currentPage=s.pagination.page)}else this.showError(a.data.message||this.tm("messages.loadSessionsError"))}catch(d){this.showError(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.loadSessionsError"))}this.loading=!1},async refreshSessions(){await this.loadSessions(),this.showSuccess(this.tm("messages.refreshSuccess"))},async updatePersona(o,t){return this._updateSession("persona",o,{persona_name:t},(d,a)=>{var s;a&&(d.persona_id=t,d.persona_name=t==="[%None]"?this.tm("persona.none"):((s=this.availablePersonas.find(n=>n.name===t))==null?void 0:s.name)||t)})},async updateProvider(o,t,d){return this._updateSession("provider",o,{provider_id:t,provider_type:d},(a,s)=>{if(s){if(d==="chat_completion"){a.chat_provider_id=t;const n=this.availableChatProviders.find(e=>e.id===t);a.chat_provider_name=(n==null?void 0:n.name)||t}else if(d==="speech_to_text"){a.stt_provider_id=t;const n=this.availableSttProviders.find(e=>e.id===t);a.stt_provider_name=(n==null?void 0:n.name)||t}else if(d==="text_to_speech"){a.tts_provider_id=t;const n=this.availableTtsProviders.find(e=>e.id===t);a.tts_provider_name=(n==null?void 0:n.name)||t}}})},async updateLLM(o,t){return this._updateSession("llm",o,{enabled:t},(d,a)=>{a&&(d.llm_enabled=t)})},async updateTTS(o,t){return this._updateSession("tts",o,{enabled:t},(d,a)=>{a&&(d.tts_enabled=t)})},async _updateSession(o,t,d,a){var n,e,m,b;if(Array.isArray(t)){const g=t,f=g.map(_=>_.session_id);try{const _={is_batch:!0,session_ids:f,...d},F=await v.post(`/api/session/update_${o}`,_);if(F.data.status==="ok"){const K=F.data.data;return g.forEach(O=>{const R=!K.error_sessions||!K.error_sessions.includes(O.session_id);a(O,R)}),{success:!0,successCount:K.success_count||0,errorCount:K.error_count||0,errorSessions:K.error_sessions||[]}}else return{success:!1,error:F.data.message,errorCount:f.length,successCount:0}}catch(_){return{success:!1,error:((b=(m=_.response)==null?void 0:m.data)==null?void 0:b.message)||_.message,errorCount:f.length,successCount:0}}}else{const g=t;g.updating=!0;try{const f={is_batch:!1,session_id:g.session_id,...d},_=await v.post(`/api/session/update_${o}`,f);return _.data.status==="ok"?(a(g,!0),this.showSuccess(this.tm(`messages.${o}UpdateSuccess`)),{success:!0}):(this.showError(_.data.message||this.tm(`messages.${o}UpdateError`)),{success:!1,error:_.data.message})}catch(f){return this.showError(((e=(n=f.response)==null?void 0:n.data)==null?void 0:e.message)||this.tm(`messages.${o}UpdateError`)),{success:!1,error:f.message}}finally{g.updating=!1}}},async updateSessionStatus(o,t){var d,a;o.updating=!0;try{const s=await v.post("/api/session/update_status",{session_id:o.session_id,session_enabled:t});s.data.status==="ok"?(o.session_enabled=t,this.showSuccess(this.tm("messages.sessionStatusSuccess",{status:t?this.tm("status.enabled"):this.tm("status.disabled")}))):this.showError(s.data.message||this.tm("messages.statusUpdateError"))}catch(s){this.showError(((a=(d=s.response)==null?void 0:d.data)==null?void 0:a.message)||this.tm("messages.statusUpdateError"))}o.updating=!1},async applyBatchChanges(){if(!this.batchPersona&&!this.batchChatProvider&&!this.batchSttProvider&&!this.batchTtsProvider&&this.batchLlmStatus===null&&this.batchTtsStatus===null)return;this.batchUpdating=!0;let o=0,t=0,d=[];const a=this.sessions;try{const s=[];this.batchPersona&&s.push({type:"persona",params:{persona_name:this.batchPersona}}),this.batchChatProvider&&s.push({type:"provider",params:{provider_id:this.batchChatProvider,provider_type:"chat_completion"}}),this.batchSttProvider&&s.push({type:"provider",params:{provider_id:this.batchSttProvider,provider_type:"speech_to_text"}}),this.batchTtsProvider&&s.push({type:"provider",params:{provider_id:this.batchTtsProvider,provider_type:"text_to_speech"}}),this.batchLlmStatus!==null&&s.push({type:"llm",params:{enabled:this.batchLlmStatus}}),this.batchTtsStatus!==null&&s.push({type:"tts",params:{enabled:this.batchTtsStatus}});for(const n of s){let e;switch(n.type){case"persona":e=(b,g)=>{g&&(b.persona_id=n.params.persona_name)};break;case"provider":e=(b,g)=>{if(!g)return;const{provider_id:f,provider_type:_}=n.params;_==="chat_completion"?b.chat_provider_id=f:_==="speech_to_text"?b.stt_provider_id=f:_==="text_to_speech"&&(b.tts_provider_id=f)};break;case"llm":e=(b,g)=>{g&&(b.llm_enabled=n.params.enabled)};break;case"tts":e=(b,g)=>{g&&(b.tts_enabled=n.params.enabled)};break}const m=await this._updateSession(n.type,a,n.params,e);o+=m.successCount||0,t+=m.errorCount||0,m.errorSessions&&d.push(...m.errorSessions)}if(t===0)this.showSuccess(this.tm("messages.batchUpdateSuccess",{count:o}));else{const n=[...new Set(d)];this.showError(this.tm("messages.batchUpdatePartial",{success:o,error:n.length}))}}catch{this.showError(this.tm("messages.batchUpdateError"))}this.batchUpdating=!1,this.batchPersona=null,this.batchChatProvider=null,this.batchSttProvider=null,this.batchTtsProvider=null,this.batchLlmStatus=null,this.batchTtsStatus=null},async openPluginManager(o){var t,d;this.selectedSessionForPlugin=o,this.pluginDialog=!0,this.loadingPlugins=!0,this.sessionPlugins=[];try{const a=await v.get("/api/session/plugins",{params:{session_id:o.session_id}});a.data.status==="ok"?this.sessionPlugins=a.data.data.plugins.map(s=>({...s,updating:!1})):this.showError(a.data.message||this.tm("messages.loadPluginsError"))}catch(a){this.showError(((d=(t=a.response)==null?void 0:t.data)==null?void 0:d.message)||this.tm("messages.loadPluginsError"))}this.loadingPlugins=!1},async togglePlugin(o,t){var d,a;o.updating=!0;try{const s=await v.post("/api/session/update_plugin",{session_id:this.selectedSessionForPlugin.session_id,plugin_name:o.name,enabled:t});s.data.status==="ok"?(o.enabled=t,this.showSuccess(this.tm("messages.pluginStatusSuccess",{name:o.name,status:t?this.tm("status.enabled"):this.tm("status.disabled")}))):this.showError(s.data.message||this.tm("messages.pluginStatusError"))}catch(s){this.showError(((a=(d=s.response)==null?void 0:d.data)==null?void 0:a.message)||this.tm("messages.pluginStatusError"))}o.updating=!1},openNameEditor(o){this.selectedSessionForName=o,this.newSessionName=o.session_name===o.session_raw_name?"":o.session_name,this.nameEditDialog=!0},async saveSessionName(){var o,t;if(this.selectedSessionForName){this.nameEditLoading=!0;try{const d=await v.post("/api/session/update_name",{session_id:this.selectedSessionForName.session_id,custom_name:this.newSessionName||""});d.data.status==="ok"?(this.selectedSessionForName.session_name=d.data.data.display_name,this.showSuccess(d.data.data.message||this.tm("messages.nameUpdateSuccess")),this.nameEditDialog=!1):this.showError(d.data.message||this.tm("messages.nameUpdateError"))}catch(d){this.showError(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.nameUpdateError"))}this.nameEditLoading=!1}},getPlatformColor(o){const t={aiocqhttp:"blue",wechatpadpro:"green",qq_official:"purple",telegram:"light-blue",discord:"indigo",default:"grey"};return t[o]||t.default},showSuccess(o){this.snackbarText=o,this.snackbarColor="success",this.snackbar=!0},showError(o){this.snackbarText=o,this.snackbarColor="error",this.snackbar=!0},async deleteSession(o){var d,a;const t=this.tm("deleteConfirm.message",{sessionName:o.session_name||o.session_id})+`

`+this.tm("deleteConfirm.warning");if(confirm(t)){o.deleting=!0;try{const s=await v.post("/api/session/delete",{session_id:o.session_id});if(s.data.status==="ok"){this.showSuccess(s.data.data.message||this.tm("messages.deleteSuccess"));const n=this.sessions.findIndex(e=>e.session_id===o.session_id);n>-1&&this.sessions.splice(n,1)}else this.showError(s.data.message||this.tm("messages.deleteError"))}catch(s){this.showError(((a=(d=s.response)==null?void 0:d.data)==null?void 0:a.message)||this.tm("messages.deleteError"))}o.deleting=!1}},handlePaginationUpdate(o){this.currentPage=o.page,this.itemsPerPage=o.itemsPerPage,this.loadSessions()},handleSearchChange:me.debounce(function(){this.currentPage=1,this.loadSessions()},300),handlePlatformChange(){this.currentPage=1,this.loadSessions()},async openKBManager(o){this.selectedSessionForKB=o,this.sessionKBConfig={kb_ids:[],top_k:5,enable_rerank:!0},this.kbDialog=!0,this.loadingKBConfig=!0;try{const t=await v.get("/api/kb/list");t.data.status==="ok"&&(this.availableKBs=t.data.data.items);const d=await v.get("/api/kb/session/config/get",{params:{session_id:o.session_id}});if(d.data.status==="ok"){const a=d.data.data;this.sessionKBConfig={kb_ids:[],top_k:a.top_k||5,enable_rerank:a.enable_rerank!==!1},a.kb_ids&&Array.isArray(a.kb_ids)&&(this.sessionKBConfig.kb_ids=a.kb_ids.filter(s=>s!=null&&s!==""))}else this.sessionKBConfig={kb_ids:[],top_k:5,enable_rerank:!0}}catch(t){console.error("加载知识库配置失败:",t),this.showError(this.tm("knowledgeBase.loadFailed"))}finally{this.loadingKBConfig=!1}},async saveKBConfig(){var t,d;if(!this.selectedSessionForKB)return;const o=Array.isArray(this.sessionKBConfig.kb_ids)?this.sessionKBConfig.kb_ids.filter(a=>a!=null&&a!==""):[];this.savingKBConfig=!0;try{const a={scope:"session",scope_id:this.selectedSessionForKB.session_id,kb_ids:o,top_k:this.sessionKBConfig.top_k,enable_rerank:this.sessionKBConfig.enable_rerank},s=await v.post("/api/kb/session/config/set",a);s.data.status==="ok"?(this.showSuccess(this.tm("knowledgeBase.saveSuccess")),this.kbDialog=!1,this.sessionKBConfig={kb_ids:[],top_k:5,enable_rerank:!0},this.selectedSessionForKB=null):this.showError(s.data.message||this.tm("knowledgeBase.saveFailed"))}catch(a){console.error("保存知识库配置失败:",a),this.showError(((d=(t=a.response)==null?void 0:t.data)==null?void 0:d.message)||this.tm("knowledgeBase.saveFailed"))}finally{this.savingKBConfig=!1}},closeKBDialog(){this.kbDialog=!1,this.sessionKBConfig={kb_ids:[],top_k:5,enable_rerank:!0},this.selectedSessionForKB=null,this.availableKBs=[]},async clearKBConfig(){var o,t;if(this.selectedSessionForKB&&confirm(this.tm("knowledgeBase.clearConfirm"))){this.savingKBConfig=!0;try{const d=await v.post("/api/kb/session/config/delete",{scope:"session",scope_id:this.selectedSessionForKB.session_id});d.data.status==="ok"?(this.showSuccess(this.tm("knowledgeBase.clearSuccess")),this.sessionKBConfig={kb_ids:[],top_k:5,enable_rerank:!0}):this.showError(d.data.message||this.tm("knowledgeBase.clearFailed"))}catch(d){console.error("清除知识库配置失败:",d),this.showError(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("knowledgeBase.clearFailed"))}finally{this.savingKBConfig=!1}}},goToKBPage(){this.$router.push("/knowledge-base")}}},Q=o=>(de("data-v-1fd7999b"),o=o(),ce(),o),ge={class:"session-management-page"},pe={class:"text-h4"},_e={class:"d-flex align-center"},be={key:0},fe={style:{color:"grey"}},ve={key:1},ye=Q(()=>c("p",null,"使用 /sid 指令可查看会话 ID。",-1)),ke=Q(()=>c("p",null,"会话信息：",-1)),Se={key:0},Pe={key:1},xe={key:2},Ce={style:{"font-size":"12px"}},we={style:{"font-size":"12px"}},Be={style:{"font-size":"12px"}},Ve={style:{"font-size":"12px"}},Ke={class:"text-center py-8"},Ee={class:"text-h6 mt-4 text-grey-600"},Ue={class:"text-body-2 text-grey-500"},Te={class:"text-h4"},Fe={style:{padding:"16px"}},De={class:"d-flex justify-end align-center mt-8"},Le={style:{"padding-left":"16px","padding-right":"16px"}},Ne={key:0,class:"text-center py-8"},Oe={class:"text-h6 mt-4 text-grey-600"},ze={class:"text-body-2 text-grey-500"},Me={class:"text-body-1 mt-4"},Ae={style:{"padding-left":"16px","padding-right":"16px"}},Ie={class:"text-caption text-grey-600 mb-2"},We={class:"text-caption text-grey-600 mb-2"},qe={style:{padding:"16px"}},Qe={class:"mb-4"},Re={class:"text-subtitle-2 mb-2"},He={key:0,class:"text-body-2 text-medium-emphasis"},je={key:1,class:"kb-selector-list"},Ge={class:"d-flex align-center"},Xe={style:{"font-size":"18px","margin-right":"8px"}},Ze={class:"text-body-2"},Je={class:"text-caption text-medium-emphasis"},Ye={class:"text-caption text-medium-emphasis mt-2"},$e={key:0,class:"text-center py-8"},es={class:"mt-4 text-medium-emphasis"},ss={class:"text-body-1 mt-4"};function ts(o,t,d,a,s,n){return h(),y("div",ge,[i(G,{fluid:"",class:"pa-0"},{default:l(()=>[i(B,{flat:""},{default:l(()=>[i(E,{class:"d-flex align-center py-3 px-4"},{default:l(()=>[c("span",pe,r(a.tm("sessions.activeSessions")),1),i(X,{size:"small",class:"ml-2"},{default:l(()=>[u(r(s.totalItems)+" "+r(a.tm("sessions.sessionCount")),1)]),_:1}),i(T,{class:"me-4 ms-4",dense:""},{default:l(()=>[i(D,{modelValue:s.searchQuery,"onUpdate:modelValue":[t[0]||(t[0]=e=>s.searchQuery=e),n.handleSearchChange],"prepend-inner-icon":"mdi-magnify",label:a.tm("search.placeholder"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",class:"me-4",density:"compact"},null,8,["modelValue","label","onUpdate:modelValue"]),i(S,{modelValue:s.filterPlatform,"onUpdate:modelValue":[t[1]||(t[1]=e=>s.filterPlatform=e),n.handlePlatformChange],items:n.platformOptions,label:a.tm("search.platformFilter"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",class:"me-4",style:{"max-width":"150px"},density:"compact"},null,8,["modelValue","items","label","onUpdate:modelValue"])]),_:1}),i(p,{color:"primary","prepend-icon":"mdi-refresh",variant:"tonal",onClick:n.refreshSessions,loading:s.loading,size:"small"},{default:l(()=>[u(r(a.tm("buttons.refresh")),1)]),_:1},8,["onClick","loading"])]),_:1}),i(z),i(w,{class:"pa-0"},{default:l(()=>[i(Z,{headers:n.headers,items:s.sessions,loading:s.loading,"items-per-page":s.itemsPerPage,page:s.currentPage,"items-length":s.totalItems,"onUpdate:options":n.handlePaginationUpdate,density:"compact",class:"elevation-0",style:{"font-size":"11px"}},{"item.session_enabled":l(({item:e})=>[i(V,{"model-value":e.session_enabled,"onUpdate:modelValue":m=>n.updateSessionStatus(e,m),loading:e.updating,"hide-details":"",density:"compact",color:"success"},null,8,["model-value","onUpdate:modelValue","loading"])]),"item.session_info":l(({item:e})=>[c("div",null,[c("div",_e,[i(L,{location:"top"},{activator:l(({props:m})=>[e.session_name!==e.session_raw_name?(h(),y("div",be,[c("span",null,r(e.session_name),1),c("span",fe,"("+r(e.session_id)+")",1)])):(h(),y("div",ve,[c("span",J(Y(m)),r(e.session_id),17)]))]),default:l(()=>[c("div",null,[ye,ke,c("ul",null,[c("li",null,"机器人 ID: "+r(e.platform),1),e.message_type?(h(),y("li",Se,"消息类型: "+r(e.message_type),1)):x("",!0),e.session_raw_name?(h(),y("li",Pe,"会话 ID: "+r(e.session_raw_name),1)):x("",!0),e.user_name?(h(),y("li",xe,"用户: "+r(e.user_name),1)):x("",!0)])])]),_:2},1024),i(p,{icon:"",size:"x-small",variant:"plain",onClick:m=>n.openNameEditor(e),class:"ml-2",loading:e.updating},{default:l(()=>[i(P,null,{default:l(()=>[u("mdi-pencil")]),_:1}),i(L,{activator:"parent",location:"top"},{default:l(()=>[u(r(a.tm("buttons.editName")),1)]),_:1})]),_:2},1032,["onClick","loading"])])])]),"item.persona":l(({item:e})=>[i(S,{"model-value":e.persona_id||"",items:n.personaOptions,"item-title":"label","item-value":"value","hide-details":"",density:"compact",variant:"solo-filled",flat:"","onUpdate:modelValue":m=>n.updatePersona(e,m),loading:e.updating,disabled:!e.session_enabled},{selection:l(({item:m})=>[c("span",Ce,r(m.raw.label),1)]),_:2},1032,["model-value","items","onUpdate:modelValue","loading","disabled"])]),"item.chat_provider":l(({item:e})=>[i(S,{"model-value":e.chat_provider_id||"",items:n.chatProviderOptions,"item-title":"label","item-value":"value","hide-details":"",density:"compact",variant:"solo-filled",flat:"","onUpdate:modelValue":m=>n.updateProvider(e,m,"chat_completion"),loading:e.updating,disabled:!e.session_enabled},{selection:l(({item:m})=>[c("span",we,r(m.raw.label),1)]),_:2},1032,["model-value","items","onUpdate:modelValue","loading","disabled"])]),"item.stt_provider":l(({item:e})=>[i(S,{"model-value":e.stt_provider_id||"",items:n.sttProviderOptions,"item-title":"label","item-value":"value","hide-details":"",density:"compact",variant:"solo-filled",flat:"","onUpdate:modelValue":m=>n.updateProvider(e,m,"speech_to_text"),loading:e.updating,disabled:n.sttProviderOptions.length===0||!e.session_enabled},{selection:l(({item:m})=>[c("span",Be,r(m.raw.label),1)]),_:2},1032,["model-value","items","onUpdate:modelValue","loading","disabled"])]),"item.tts_provider":l(({item:e})=>[i(S,{"model-value":e.tts_provider_id||"",items:n.ttsProviderOptions,"item-title":"label","item-value":"value","hide-details":"",density:"compact",variant:"solo-filled",flat:"","onUpdate:modelValue":m=>n.updateProvider(e,m,"text_to_speech"),loading:e.updating,disabled:n.ttsProviderOptions.length===0||!e.session_enabled},{selection:l(({item:m})=>[c("span",Ve,r(m.raw.label),1)]),_:2},1032,["model-value","items","onUpdate:modelValue","loading","disabled"])]),"item.llm_enabled":l(({item:e})=>[i(V,{"model-value":e.llm_enabled,"onUpdate:modelValue":m=>n.updateLLM(e,m),loading:e.updating,disabled:!e.session_enabled,"hide-details":"",density:"compact",color:"primary"},null,8,["model-value","onUpdate:modelValue","loading","disabled"])]),"item.tts_enabled":l(({item:e})=>[i(V,{"model-value":e.tts_enabled,"onUpdate:modelValue":m=>n.updateTTS(e,m),loading:e.updating,disabled:!e.session_enabled,"hide-details":"",density:"compact",color:"secondary"},null,8,["model-value","onUpdate:modelValue","loading","disabled"])]),"item.knowledge_base":l(({item:e})=>[i(p,{size:"x-small",variant:"tonal",color:"info",onClick:m=>n.openKBManager(e),loading:e.loadingKB,disabled:!e.session_enabled},{default:l(()=>[u(r(a.tm("knowledgeBase.configure")),1)]),_:2},1032,["onClick","loading","disabled"])]),"item.plugins":l(({item:e})=>[i(p,{size:"x-small",variant:"tonal",color:"primary",onClick:m=>n.openPluginManager(e),loading:e.loadingPlugins,disabled:!e.session_enabled},{default:l(()=>[u(r(a.tm("buttons.edit")),1)]),_:2},1032,["onClick","loading","disabled"])]),"item.actions":l(({item:e})=>[i(p,{size:"x-small",variant:"tonal",color:"error",onClick:m=>n.deleteSession(e),loading:e.deleting,icon:""},{default:l(()=>[i(P,null,{default:l(()=>[u("mdi-delete")]),_:1}),i(L,{activator:"parent",location:"top"},{default:l(()=>[u(r(a.tm("buttons.delete")),1)]),_:1})]),_:2},1032,["onClick","loading"])]),"no-data":l(()=>[c("div",Ke,[i(P,{size:"64",color:"grey-400"},{default:l(()=>[u("mdi-account-group-outline")]),_:1}),c("div",Ee,r(a.tm("sessions.noActiveSessions")),1),c("div",Ue,r(a.tm("sessions.noActiveSessionsDesc")),1)])]),_:1},8,["headers","items","loading","items-per-page","page","items-length","onUpdate:options"])]),_:1})]),_:1}),i(B,{flat:"",class:"mt-4"},{default:l(()=>[i(E,{class:"d-flex align-center py-3 px-4"},{default:l(()=>[c("span",Te,r(a.tm("batchOperations.title")),1)]),_:1}),i(w,null,{default:l(()=>[c("div",Fe,[i(T,null,{default:l(()=>[s.availablePersonas.length>0?(h(),k(C,{key:0,cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchPersona,"onUpdate:modelValue":t[2]||(t[2]=e=>s.batchPersona=e),items:n.personaOptions,"item-title":"label","item-value":"value",label:a.tm("batchOperations.setPersona"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select"},null,8,["modelValue","items","label"])]),_:1})):x("",!0),s.availableChatProviders.length>0?(h(),k(C,{key:1,cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchChatProvider,"onUpdate:modelValue":t[3]||(t[3]=e=>s.batchChatProvider=e),items:n.chatProviderOptions,"item-title":"label","item-value":"value",label:a.tm("batchOperations.setChatProvider"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select"},null,8,["modelValue","items","label"])]),_:1})):x("",!0),i(C,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchSttProvider,"onUpdate:modelValue":t[4]||(t[4]=e=>s.batchSttProvider=e),items:n.sttProviderOptions,"item-title":"label","item-value":"value",label:a.tm("batchOperations.setSttProvider"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select",disabled:s.availableSttProviders.length===0,placeholder:s.availableSttProviders.length===0?a.tm("batchOperations.noSttProvider"):""},null,8,["modelValue","items","label","disabled","placeholder"])]),_:1}),i(C,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchTtsProvider,"onUpdate:modelValue":t[5]||(t[5]=e=>s.batchTtsProvider=e),items:n.ttsProviderOptions,"item-title":"label","item-value":"value",label:a.tm("batchOperations.setTtsProvider"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select",disabled:s.availableTtsProviders.length===0,placeholder:s.availableTtsProviders.length===0?a.tm("batchOperations.noTtsProvider"):""},null,8,["modelValue","items","label","disabled","placeholder"])]),_:1})]),_:1}),i(T,null,{default:l(()=>[i(C,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchLlmStatus,"onUpdate:modelValue":t[6]||(t[6]=e=>s.batchLlmStatus=e),items:[{label:a.tm("status.enabled"),value:!0},{label:a.tm("status.disabled"),value:!1}],"item-title":"label","item-value":"value",label:a.tm("batchOperations.setLlmStatus"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select"},null,8,["modelValue","items","label"])]),_:1}),i(C,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i(S,{modelValue:s.batchTtsStatus,"onUpdate:modelValue":t[7]||(t[7]=e=>s.batchTtsStatus=e),items:[{label:a.tm("status.enabled"),value:!0},{label:a.tm("status.disabled"),value:!1}],"item-title":"label","item-value":"value",label:a.tm("batchOperations.setTtsStatus"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",density:"comfortable",class:"batch-select"},null,8,["modelValue","items","label"])]),_:1})]),_:1}),c("div",De,[i(p,{color:"primary",variant:"tonal",size:"large",rounded:"lg",onClick:n.applyBatchChanges,disabled:!s.batchPersona&&!s.batchChatProvider&&!s.batchSttProvider&&!s.batchTtsProvider&&s.batchLlmStatus===null&&s.batchTtsStatus===null,loading:s.batchUpdating,class:"me-3"},{default:l(()=>[i(P,{start:""},{default:l(()=>[u("mdi-check-all")]),_:1}),u(" "+r(a.tm("buttons.apply")),1)]),_:1},8,["onClick","disabled","loading"])])])]),_:1})]),_:1}),i(N,{modelValue:s.pluginDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>s.pluginDialog=e),"max-width":"800","min-height":"80%"},{default:l(()=>[s.selectedSessionForPlugin?(h(),k(B,{key:0},{default:l(()=>[i(E,{class:"bg-primary text-white py-3 px-4",style:{display:"flex","align-items":"center"}},{default:l(()=>[c("span",null,r(a.tm("pluginManagement.title"))+" - "+r(s.selectedSessionForPlugin.session_name),1),i(U),i(p,{icon:"",variant:"text",color:"white",onClick:t[8]||(t[8]=e=>s.pluginDialog=!1)},{default:l(()=>[i(P,null,{default:l(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),s.loadingPlugins?(h(),k(w,{key:1,class:"text-center py-8"},{default:l(()=>[i(I,{indeterminate:"",color:"primary",size:"48"}),c("div",Me,r(a.tm("pluginManagement.loading")),1)]),_:1})):(h(),k(w,{key:0},{default:l(()=>[c("div",Le,[s.sessionPlugins.length===0?(h(),y("div",Ne,[i(P,{size:"64",color:"grey-400"},{default:l(()=>[u("mdi-puzzle-outline")]),_:1}),c("div",Oe,r(a.tm("pluginManagement.noPlugins")),1),c("div",ze,r(a.tm("pluginManagement.noPluginsDesc")),1)])):(h(),k($,{key:1},{default:l(()=>[(h(!0),y(M,null,A(s.sessionPlugins,e=>(h(),k(ee,{key:e.name,class:"px-0"},{prepend:l(()=>[i(P,{color:e.enabled?"success":"grey"},{default:l(()=>[u(r(e.enabled?"mdi-check-circle":"mdi-circle-outline"),1)]),_:2},1032,["color"])]),append:l(()=>[i(V,{"model-value":e.enabled,"hide-details":"",color:"primary","onUpdate:modelValue":m=>n.togglePlugin(e,m),loading:e.updating},null,8,["model-value","onUpdate:modelValue","loading"])]),default:l(()=>[i(se,{class:"font-weight-medium"},{default:l(()=>[u(r(e.name),1)]),_:2},1024),i(te,null,{default:l(()=>[u(r(a.tm("pluginManagement.author"))+": "+r(e.author),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),_:1}))]),_:1})):x("",!0)]),_:1},8,["modelValue"]),i(N,{modelValue:s.nameEditDialog,"onUpdate:modelValue":t[13]||(t[13]=e=>s.nameEditDialog=e),"max-width":"500","min-height":"60%"},{default:l(()=>[s.selectedSessionForName?(h(),k(B,{key:0},{default:l(()=>[i(E,{class:"bg-primary text-white py-3 px-4",style:{display:"flex","align-items":"center"}},{default:l(()=>[c("span",null,r(a.tm("nameEditor.title")),1),i(U),i(p,{icon:"",variant:"text",color:"white",onClick:t[10]||(t[10]=e=>s.nameEditDialog=!1)},{default:l(()=>[i(P,null,{default:l(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),i(w,null,{default:l(()=>[c("div",Ae,[i(D,{modelValue:s.newSessionName,"onUpdate:modelValue":t[11]||(t[11]=e=>s.newSessionName=e),label:a.tm("nameEditor.customName"),placeholder:a.tm("nameEditor.placeholder"),variant:"solo-filled",flat:"","hide-details":"auto",clearable:"",class:"mb-4",onKeyup:ae(n.saveSessionName,["enter"])},null,8,["modelValue","label","placeholder","onKeyup"]),c("div",Ie,r(a.tm("nameEditor.originalName"))+": "+r(s.selectedSessionForName.session_raw_name),1),c("div",We,r(a.tm("nameEditor.fullSessionId"))+": "+r(s.selectedSessionForName.session_id),1),i(W,{variant:"tonal",type:"info",density:"compact",class:"mb-4"},{default:l(()=>[u(r(a.tm("nameEditor.hint")),1)]),_:1})])]),_:1}),i(q,{class:"px-4 pb-4"},{default:l(()=>[i(U),i(p,{color:"grey",variant:"text",onClick:t[12]||(t[12]=e=>s.nameEditDialog=!1),disabled:s.nameEditLoading},{default:l(()=>[u(r(a.tm("buttons.cancel")),1)]),_:1},8,["disabled"]),i(p,{color:"primary",variant:"tonal",onClick:n.saveSessionName,loading:s.nameEditLoading},{default:l(()=>[u(r(a.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"]),i(N,{modelValue:s.kbDialog,"onUpdate:modelValue":[t[19]||(t[19]=e=>s.kbDialog=e),t[20]||(t[20]=e=>{e||n.closeKBDialog()})],"max-width":"800","min-height":"60%"},{default:l(()=>[s.selectedSessionForKB?(h(),k(B,{key:0},{default:l(()=>[i(E,{class:"bg-primary text-white py-3 px-4",style:{display:"flex","align-items":"center"}},{default:l(()=>[c("span",null,r(a.tm("knowledgeBase.title"))+" - "+r(s.selectedSessionForKB.session_name),1),i(U),i(p,{icon:"",variant:"text",color:"white",onClick:t[14]||(t[14]=e=>n.closeKBDialog())},{default:l(()=>[i(P,null,{default:l(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),s.loadingKBConfig?(h(),k(w,{key:1,class:"text-center py-8"},{default:l(()=>[i(I,{indeterminate:"",color:"primary",size:"48"}),c("div",ss,r(a.tm("knowledgeBase.loading")),1)]),_:1})):(h(),k(w,{key:0},{default:l(()=>[c("div",qe,[i(W,{type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[u(r(a.tm("knowledgeBase.description")),1)]),_:1}),c("div",Qe,[c("div",Re,r(a.tm("knowledgeBase.selectKB")),1),i(B,{variant:"outlined",class:"pa-3"},{default:l(()=>[s.availableKBs.length===0?(h(),y("div",He,r(a.tm("knowledgeBase.noKBAvailable")||"暂无可用知识库"),1)):(h(),y("div",je,[(h(!0),y(M,null,A(s.availableKBs,e=>(h(),k(V,{key:e.kb_id,value:e.kb_id,modelValue:s.sessionKBConfig.kb_ids,"onUpdate:modelValue":t[15]||(t[15]=m=>s.sessionKBConfig.kb_ids=m),"hide-details":"",density:"compact",class:"mb-1"},{label:l(()=>[c("div",Ge,[c("span",Xe,r(e.emoji),1),c("div",null,[c("div",Ze,r(e.kb_name),1),c("div",Je,r(e.description||a.tm("knowledgeBase.noKBDesc"))+" - "+r(e.doc_count)+" "+r(a.tm("list.documents",{count:e.doc_count})),1)])])]),_:2},1032,["value","modelValue"]))),128))]))]),_:1}),c("div",Ye,r(a.tm("knowledgeBase.selectMultiple")),1)]),i(le,{class:"mb-4"},{default:l(()=>[i(ie,null,{default:l(()=>[i(oe,null,{default:l(()=>[i(P,{class:"mr-2"},{default:l(()=>[u("mdi-cog")]),_:1}),u(" "+r(a.tm("knowledgeBase.advancedSettings")),1)]),_:1}),i(ne,null,{default:l(()=>[i(T,null,{default:l(()=>[i(C,{cols:"12",md:"6"},{default:l(()=>[i(D,{modelValue:s.sessionKBConfig.top_k,"onUpdate:modelValue":t[16]||(t[16]=e=>s.sessionKBConfig.top_k=e),modelModifiers:{number:!0},label:a.tm("knowledgeBase.topK"),type:"number",variant:"outlined",density:"comfortable",hint:a.tm("knowledgeBase.topKHint"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),i(C,{cols:"12",md:"6"},{default:l(()=>[i(V,{modelValue:s.sessionKBConfig.enable_rerank,"onUpdate:modelValue":t[17]||(t[17]=e=>s.sessionKBConfig.enable_rerank=e),label:a.tm("knowledgeBase.enableRerank"),color:"primary",hint:a.tm("knowledgeBase.enableRerankHint"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s.availableKBs.length===0?(h(),y("div",$e,[i(P,{size:"64",color:"grey-lighten-2"},{default:l(()=>[u("mdi-database-off")]),_:1}),c("p",es,r(a.tm("knowledgeBase.noKBAvailable")),1),i(p,{color:"primary",variant:"tonal",class:"mt-2",onClick:n.goToKBPage},{default:l(()=>[u(r(a.tm("knowledgeBase.createKB")),1)]),_:1},8,["onClick"])])):x("",!0)])]),_:1})),i(z),i(q,{class:"pa-4"},{default:l(()=>[i(p,{variant:"text",onClick:n.clearKBConfig,disabled:s.savingKBConfig||s.loadingKBConfig},{default:l(()=>[u(r(a.tm("knowledgeBase.clearConfig")),1)]),_:1},8,["onClick","disabled"]),i(U),i(p,{variant:"text",onClick:t[18]||(t[18]=e=>n.closeKBDialog()),disabled:s.savingKBConfig},{default:l(()=>[u(r(a.tm("knowledgeBase.cancel")),1)]),_:1},8,["disabled"]),i(p,{color:"primary",variant:"tonal",onClick:n.saveKBConfig,loading:s.savingKBConfig},{default:l(()=>[u(r(a.tm("knowledgeBase.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"]),i(re,{modelValue:s.snackbar,"onUpdate:modelValue":t[21]||(t[21]=e=>s.snackbar=e),timeout:3e3,elevation:"24",color:s.snackbarColor,location:"top"},{default:l(()=>[u(r(s.snackbarText),1)]),_:1},8,["modelValue","color"])]),_:1})])}const os=ue(he,[["render",ts],["__scopeId","data-v-1fd7999b"]]);export{os as default};
