import{V as Te}from"./index-27248cb2.js";import{P as X,a as He,K as We,L as Ie,O as Xe}from"./KnowledgeBaseSelector-f63d1cc5.js";import{u as Ye,c as Me,z as q,r as ke,o as t,g as n,b as l,w as m,e as v,t as V,A as Q,d as Y,p as r,q as M,a as o,Z as pe,F as R,h as Se,an as _e,am as Z,V as Ae,$ as w,C as G,ap as ea,aM as aa,ad as Le,f as x,l as Oe,aN as De,aJ as Ne,al as Pe,a0 as qe,P as $e,M as ta,aO as la,aP as da,L as ia,aQ as ma,a2 as na,a5 as ua}from"./index-77b120c5.js";import{u as ze}from"./toast-0c57477c.js";import{_ as sa}from"./_plugin-vue_export-helper-c27b6911.js";const oa={key:0,class:"config-section"},ca={class:"metadata-key"},ba={key:0,class:"important-hint"},fa={key:0,class:"object-config"},ya={key:0,class:"nested-object"},Va={key:0,class:"nested-container"},va={key:0},Ka={class:"property-key"},ga={key:1},ra={key:0,class:"important-hint"},ha={key:0,class:"w-100"},Ua={key:0},xa={key:1},Ca={key:2},wa={key:3},Ea={key:4},ja={key:5,class:"d-flex align-center gap-2"},Ba={key:6,class:"d-flex flex-wrap gap-20"},Ta={key:9,class:"editor-container"},Ia={key:1,class:"w-100"},Sa={key:1,class:"simple-config"},Aa={class:"property-key"},La={key:0,class:"important-hint"},Oa={class:"w-100"},Da={__name:"AstrBotConfig",props:{metadata:{type:Object,required:!0},iterable:{type:Object,required:!0},metadataKey:{type:String,required:!0},isEditing:{type:Boolean,default:!1}},setup(e){const E=e,{t:H}=Ye(),k=Me(()=>{if(!E.iterable)return{};const{hint:f,...i}=E.iterable;return i}),j=q(!1),$=q(""),p=q("json"),_=q("vs-light");let W=null;const z=q(!1);function Fe(f,i,u,c){$.value=f,p.value=c||"json",_.value=u||"vs-light",W=i,j.value=!0}function Je(){j.value=!1}async function Qe(f){var i;if(!z.value){z.value=!0;try{const u=await ua.post("/api/config/provider/get_embedding_dim",{provider_config:f});u.data.status!="error"&&((i=u.data.data)!=null&&i.embedding_dimensions)?(console.log(u.data.data.embedding_dimensions),f.embedding_dimensions=u.data.data.embedding_dimensions,ze().success("获取成功: "+u.data.data.embedding_dimensions)):ze().error(u.data.message)}catch(u){console.error("Error getting embedding dimensions:",u)}finally{z.value=!1}}}function Re(f,i){const u=i.split(".");let c=f;for(const s of u)if(c&&typeof c=="object"&&s in c)c=c[s];else return;return c}function F(f,i){if(!(f!=null&&f.condition))return!0;for(const[u,c]of Object.entries(f.condition))if(Re(E.iterable,u)!==c)return!1;return!0}function Ze(f,i){const u=Object.entries(f);for(let c=i+1;c<u.length;c++){const[s,C]=u[c],b=E.metadata[E.metadataKey].items[s];if(!(b!=null&&b.invisible)&&F(b))return!0}return!1}return(f,i)=>{var c;const u=ke("AstrBotConfig",!0);return t(),n(R,null,[e.iterable&&((c=e.metadata[e.metadataKey])==null?void 0:c.type)==="object"?(t(),n("div",oa,[l(Y,{class:"config-title"},{default:m(()=>{var s;return[v(V((s=e.metadata[e.metadataKey])==null?void 0:s.description)+" ",1),Q("span",ca,"("+V(e.metadataKey)+")",1)]}),_:1}),l(M,{class:"config-hint"},{default:m(()=>{var s,C,b;return[(s=e.metadata[e.metadataKey])!=null&&s.obvious_hint&&((C=e.metadata[e.metadataKey])!=null&&C.hint)?(t(),n("span",ba,"‼️")):r("",!0),v(" "+V((b=e.metadata[e.metadataKey])==null?void 0:b.hint),1)]}),_:1})])):r("",!0),l($e,{class:"px-0 py-1"},{default:m(()=>{var s,C;return[((s=e.metadata[e.metadataKey])==null?void 0:s.type)==="object"||(C=e.metadata[e.metadataKey])!=null&&C.config_template?(t(),n("div",fa,[e.iterable.hint&&!e.isEditing?(t(),o(pe,{key:0,type:"info",variant:"tonal",class:"mb-4",border:"start",density:"compact"},{default:m(()=>[v(V(e.iterable.hint),1)]),_:1})):r("",!0),(t(!0),n(R,null,Se(k.value,(b,a,U)=>{var B,T,I,S;return t(),n("div",{key:a,class:"config-item"},[((B=e.metadata[e.metadataKey].items[a])==null?void 0:B.type)==="object"?(t(),n("div",ya,[e.metadata[e.metadataKey].items[a]&&!((T=e.metadata[e.metadataKey].items[a])!=null&&T.invisible)&&F(e.metadata[e.metadataKey].items[a],a)?(t(),n("div",Va,[l(_e,null,{default:m(()=>[l(u,{metadata:e.metadata[e.metadataKey].items,iterable:e.iterable[a],metadataKey:a},null,8,["metadata","iterable","metadataKey"])]),_:2},1024)])):r("",!0)])):(t(),n(R,{key:1},[!((I=e.metadata[e.metadataKey].items[a])!=null&&I.invisible)&&F(e.metadata[e.metadataKey].items[a],a)?(t(),o(Pe,{key:0,class:"config-row"},{default:m(()=>[l(Z,{cols:"12",sm:"7",class:"property-info"},{default:m(()=>[l(Ae,{density:"compact"},{default:m(()=>[l(Y,{class:"property-name"},{default:m(()=>{var K,g;return[(K=e.metadata[e.metadataKey].items[a])!=null&&K.description?(t(),n("span",va,[v(V((g=e.metadata[e.metadataKey].items[a])==null?void 0:g.description)+" ",1),Q("span",Ka,"("+V(a)+")",1)])):(t(),n("span",ga,V(a),1))]}),_:2},1024),l(M,{class:"property-hint"},{default:m(()=>{var K,g,h;return[(K=e.metadata[e.metadataKey].items[a])!=null&&K.obvious_hint&&((g=e.metadata[e.metadataKey].items[a])!=null&&g.hint)?(t(),n("span",ra,"‼️")):r("",!0),v(" "+V((h=e.metadata[e.metadataKey].items[a])==null?void 0:h.hint),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024),l(Z,{cols:"12",sm:"5",class:"config-input"},{default:m(()=>{var K,g,h,A,L,O,D,N,y,ee,ae,te,le,de,ie,me,ne,ue,se,oe,ce,be,fe,ye,Ve,ve,Ke,ge,re,he,Ue,xe,Ce,we,Ee,je,Be;return[e.metadata[e.metadataKey].items[a]?(t(),n("div",ha,[((K=e.metadata[e.metadataKey].items[a])==null?void 0:K._special)==="select_provider"?(t(),n("div",Ua,[l(X,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,"provider-type":"chat_completion"},null,8,["modelValue","onUpdate:modelValue"])])):((g=e.metadata[e.metadataKey].items[a])==null?void 0:g._special)==="select_provider_stt"?(t(),n("div",xa,[l(X,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,"provider-type":"speech_to_text"},null,8,["modelValue","onUpdate:modelValue"])])):((h=e.metadata[e.metadataKey].items[a])==null?void 0:h._special)==="select_provider_tts"?(t(),n("div",Ca,[l(X,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,"provider-type":"text_to_speech"},null,8,["modelValue","onUpdate:modelValue"])])):((A=e.metadata[e.metadataKey].items[a])==null?void 0:A._special)==="select_persona"?(t(),n("div",wa,[l(He,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d},null,8,["modelValue","onUpdate:modelValue"])])):((L=e.metadata[e.metadataKey].items[a])==null?void 0:L._special)==="select_knowledgebase"?(t(),n("div",Ea,[l(We,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d},null,8,["modelValue","onUpdate:modelValue"])])):((O=e.metadata[e.metadataKey].items[a])==null?void 0:O._special)==="get_embedding_dim"?(t(),n("div",ja,[l(w,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,density:"compact",variant:"outlined",class:"config-field",type:"number","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(G,{color:"primary",variant:"tonal",size:"small",onClick:i[0]||(i[0]=d=>Qe(e.iterable)),loading:z.value,class:"ml-2"},{default:m(()=>[v(" 自动检测 ")]),_:1},8,["loading"])])):((D=e.metadata[e.metadataKey].items[a])==null?void 0:D.type)==="list"&&((N=e.metadata[e.metadataKey].items[a])!=null&&N.options)&&!((y=e.metadata[e.metadataKey].items[a])!=null&&y.invisible)&&((ee=e.metadata[e.metadataKey].items[a])==null?void 0:ee.render_type)==="checkbox"?(t(),n("div",Ba,[(t(!0),n(R,null,Se((ae=e.metadata[e.metadataKey].items[a])==null?void 0:ae.options,(d,J)=>{var P;return t(),o(ea,{modelValue:e.iterable[a],"onUpdate:modelValue":Ge=>e.iterable[a]=Ge,label:(P=e.metadata[e.metadataKey].items[a])!=null&&P.labels?e.metadata[e.metadataKey].items[a].labels[J]:d,value:d,class:"mr-2",color:"primary","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label","value"])}),256))])):((te=e.metadata[e.metadataKey].items[a])==null?void 0:te.type)==="list"&&((le=e.metadata[e.metadataKey].items[a])!=null&&le.options)&&!((de=e.metadata[e.metadataKey].items[a])!=null&&de.invisible)?(t(),o(aa,{key:7,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,items:(ie=e.metadata[e.metadataKey].items[a])==null?void 0:ie.options,disabled:(me=e.metadata[e.metadataKey].items[a])==null?void 0:me.readonly,density:"compact",variant:"outlined",class:"config-field","hide-details":"",chips:"",multiple:""},null,8,["modelValue","onUpdate:modelValue","items","disabled"])):(ne=e.metadata[e.metadataKey].items[a])!=null&&ne.options&&!((ue=e.metadata[e.metadataKey].items[a])!=null&&ue.invisible)?(t(),o(Le,{key:8,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,items:(se=e.metadata[e.metadataKey].items[a])==null?void 0:se.options,disabled:(oe=e.metadata[e.metadataKey].items[a])==null?void 0:oe.readonly,density:"compact",variant:"outlined",class:"config-field","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items","disabled"])):(ce=e.metadata[e.metadataKey].items[a])!=null&&ce.editor_mode&&!((be=e.metadata[e.metadataKey].items[a])!=null&&be.invisible)?(t(),n("div",Ta,[l(x(Te),{theme:((fe=e.metadata[e.metadataKey].items[a])==null?void 0:fe.editor_theme)||"vs-light",language:((ye=e.metadata[e.metadataKey].items[a])==null?void 0:ye.editor_language)||"json",style:{"min-height":"100px","flex-grow":"1",border:"1px solid rgba(0, 0, 0, 0.1)"},value:e.iterable[a],"onUpdate:value":d=>e.iterable[a]=d},null,8,["theme","language","value","onUpdate:value"]),l(G,{icon:"",size:"small",variant:"text",color:"primary",class:"editor-fullscreen-btn",onClick:d=>{var J,P;return Fe(a,e.iterable,(J=e.metadata[e.metadataKey].items[a])==null?void 0:J.editor_theme,(P=e.metadata[e.metadataKey].items[a])==null?void 0:P.editor_language)},title:x(H)("core.common.editor.fullscreen")},{default:m(()=>[l(Oe,null,{default:m(()=>[v("mdi-fullscreen")]),_:1})]),_:2},1032,["onClick","title"])])):((Ve=e.metadata[e.metadataKey].items[a])==null?void 0:Ve.type)==="string"&&!((ve=e.metadata[e.metadataKey].items[a])!=null&&ve.invisible)?(t(),o(w,{key:10,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,density:"compact",variant:"outlined",class:"config-field","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])):(((Ke=e.metadata[e.metadataKey].items[a])==null?void 0:Ke.type)==="int"||((ge=e.metadata[e.metadataKey].items[a])==null?void 0:ge.type)==="float")&&!((re=e.metadata[e.metadataKey])!=null&&re.invisible)?(t(),o(w,{key:11,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,density:"compact",variant:"outlined",class:"config-field",type:"number","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])):((he=e.metadata[e.metadataKey].items[a])==null?void 0:he.type)==="text"&&!((Ue=e.metadata[e.metadataKey].items[a])!=null&&Ue.invisible)?(t(),o(De,{key:12,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,variant:"outlined",rows:"3",class:"config-field","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])):((xe=e.metadata[e.metadataKey].items[a])==null?void 0:xe.type)==="bool"&&!((Ce=e.metadata[e.metadataKey].items[a])!=null&&Ce.invisible)?(t(),o(Ne,{key:13,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,color:"primary",inset:"",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])):((we=e.metadata[e.metadataKey].items[a])==null?void 0:we.type)==="list"&&!((Ee=e.metadata[e.metadataKey].items[a])!=null&&Ee.invisible)?(t(),o(Ie,{key:14,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,class:"config-field"},null,8,["modelValue","onUpdate:modelValue"])):((je=e.metadata[e.metadataKey].items[a])==null?void 0:je.type)==="dict"&&!((Be=e.metadata[e.metadataKey].items[a])!=null&&Be.invisible)?(t(),o(Xe,{key:15,modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,class:"config-field"},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)])):(t(),n("div",Ia,[l(w,{modelValue:e.iterable[a],"onUpdate:modelValue":d=>e.iterable[a]=d,label:a,density:"compact",variant:"outlined",class:"config-field","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]))]}),_:2},1024)]),_:2},1024)):r("",!0),Ze(k.value,U)&&!((S=e.metadata[e.metadataKey].items[a])!=null&&S.invisible)&&F(e.metadata[e.metadataKey].items[a],a)?(t(),o(qe,{key:1,class:"config-divider"})):r("",!0)],64))])}),128))])):(t(),n("div",Sa,[l(Pe,{class:"config-row"},{default:m(()=>[l(Z,{cols:"12",sm:"7",class:"property-info"},{default:m(()=>[l(Ae,{density:"compact"},{default:m(()=>[l(Y,{class:"property-name"},{default:m(()=>{var b;return[v(V((b=e.metadata[e.metadataKey])==null?void 0:b.description)+" ",1),Q("span",Aa,"("+V(e.metadataKey)+")",1)]}),_:1}),l(M,{class:"property-hint"},{default:m(()=>{var b,a,U;return[(b=e.metadata[e.metadataKey])!=null&&b.obvious_hint&&((a=e.metadata[e.metadataKey])!=null&&a.hint)?(t(),n("span",La,"‼️")):r("",!0),v(" "+V((U=e.metadata[e.metadataKey])==null?void 0:U.hint),1)]}),_:1})]),_:1})]),_:1}),l(Z,{cols:"12",sm:"5",class:"config-input"},{default:m(()=>{var b,a,U,B,T,I,S,K,g,h,A,L,O,D,N;return[Q("div",Oa,[(b=e.metadata[e.metadataKey])!=null&&b.options&&!((a=e.metadata[e.metadataKey])!=null&&a.invisible)?(t(),o(Le,{key:0,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[1]||(i[1]=y=>e.iterable[e.metadataKey]=y),items:(U=e.metadata[e.metadataKey])==null?void 0:U.options,disabled:(B=e.metadata[e.metadataKey])==null?void 0:B.readonly,density:"compact",variant:"outlined",class:"config-field","hide-details":""},null,8,["modelValue","items","disabled"])):((T=e.metadata[e.metadataKey])==null?void 0:T.type)==="string"&&!((I=e.metadata[e.metadataKey])!=null&&I.invisible)?(t(),o(w,{key:1,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[2]||(i[2]=y=>e.iterable[e.metadataKey]=y),density:"compact",variant:"outlined",class:"config-field","hide-details":""},null,8,["modelValue"])):(((S=e.metadata[e.metadataKey])==null?void 0:S.type)==="int"||((K=e.metadata[e.metadataKey])==null?void 0:K.type)==="float")&&!((g=e.metadata[e.metadataKey])!=null&&g.invisible)?(t(),o(w,{key:2,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[3]||(i[3]=y=>e.iterable[e.metadataKey]=y),density:"compact",variant:"outlined",class:"config-field",type:"number","hide-details":""},null,8,["modelValue"])):((h=e.metadata[e.metadataKey])==null?void 0:h.type)==="text"&&!((A=e.metadata[e.metadataKey])!=null&&A.invisible)?(t(),o(De,{key:3,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[4]||(i[4]=y=>e.iterable[e.metadataKey]=y),variant:"outlined","auto-grow":"",rows:"3",class:"config-field","hide-details":""},null,8,["modelValue"])):((L=e.metadata[e.metadataKey])==null?void 0:L.type)==="bool"&&!((O=e.metadata[e.metadataKey])!=null&&O.invisible)?(t(),o(Ne,{key:4,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[5]||(i[5]=y=>e.iterable[e.metadataKey]=y),color:"primary",inset:"",density:"compact","hide-details":""},null,8,["modelValue"])):((D=e.metadata[e.metadataKey])==null?void 0:D.type)==="list"&&!((N=e.metadata[e.metadataKey])!=null&&N.invisible)?(t(),o(Ie,{key:5,modelValue:e.iterable[e.metadataKey],"onUpdate:modelValue":i[6]||(i[6]=y=>e.iterable[e.metadataKey]=y),class:"config-field"},null,8,["modelValue"])):r("",!0)])]}),_:1})]),_:1}),l(qe,{class:"my-2 config-divider"})]))]}),_:1}),l(na,{modelValue:j.value,"onUpdate:modelValue":i[9]||(i[9]=s=>j.value=s),fullscreen:"",transition:"dialog-bottom-transition",scrollable:""},{default:m(()=>[l(ta,null,{default:m(()=>[l(la,{color:"primary",dark:""},{default:m(()=>[l(G,{icon:"",onClick:i[7]||(i[7]=s=>j.value=!1)},{default:m(()=>[l(Oe,null,{default:m(()=>[v("mdi-close")]),_:1})]),_:1}),l(da,null,{default:m(()=>[v(V(x(H)("core.common.editor.editingTitle"))+" - "+V($.value),1)]),_:1}),l(ia),l(ma,null,{default:m(()=>[l(G,{variant:"text",onClick:Je},{default:m(()=>[v(V(x(H)("core.common.save")),1)]),_:1})]),_:1})]),_:1}),l($e,{class:"pa-0"},{default:m(()=>[l(x(Te),{theme:_.value,language:p.value,style:{height:"calc(100vh - 64px)"},value:x(W)[$.value],"onUpdate:value":i[8]||(i[8]=s=>x(W)[$.value]=s)},null,8,["theme","language","value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Fa=sa(Da,[["__scopeId","data-v-3b03fbe8"]]);export{Fa as A};
