import{u as M,ac as z,a5 as V,r as B,g as m,b as s,w as e,Q as F,a2 as I,ak as A,o as d,al as b,A as r,l as f,e as c,t,C as v,F as w,h as P,a as p,M as x,N as C,at as L,m as N,E as j,B as U,V as D,d as E,P as S,k as y,p as h,am as k,aZ as Q}from"./index-77b120c5.js";import{P as R}from"./PersonaForm-6a4b8a9f.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";const q={name:"PersonaPage",components:{PersonaForm:R},setup(){const{t:o}=M(),{tm:n}=z("features/persona");return{t:o,tm:n}},data(){return{personas:[],loading:!1,showPersonaDialog:!1,showViewDialog:!1,editingPersona:null,viewingPersona:null,showMessage:!1,message:"",messageType:"success"}},mounted(){this.loadPersonas()},methods:{async loadPersonas(){var o,n;this.loading=!0;try{const g=await V.get("/api/persona/list");g.data.status==="ok"?this.personas=g.data.data:this.showError(g.data.message||this.tm("messages.loadError"))}catch(g){this.showError(((n=(o=g.response)==null?void 0:o.data)==null?void 0:n.message)||this.tm("messages.loadError"))}this.loading=!1},openCreateDialog(){this.editingPersona=null,this.showPersonaDialog=!0},editPersona(o){this.editingPersona=o,this.showPersonaDialog=!0},viewPersona(o){this.viewingPersona=o,this.showViewDialog=!0},handlePersonaSaved(o){this.showSuccess(o),this.loadPersonas()},async deletePersona(o){var n,g;if(confirm(this.tm("messages.deleteConfirm",{id:o.persona_id})))try{const l=await V.post("/api/persona/delete",{persona_id:o.persona_id});l.data.status==="ok"?(this.showSuccess(l.data.message||this.tm("messages.deleteSuccess")),await this.loadPersonas()):this.showError(l.data.message||this.tm("messages.deleteError"))}catch(l){this.showError(((g=(n=l.response)==null?void 0:n.data)==null?void 0:g.message)||this.tm("messages.deleteError"))}},truncateText(o,n){return o?o.length>n?o.substring(0,n)+"...":o:""},formatDate(o){return o?new Date(o).toLocaleString():""},showSuccess(o){this.message=o,this.messageType="success",this.showMessage=!0},showError(o){this.message=o,this.messageType="error",this.showMessage=!0}}},G={class:"persona-page"},H={class:"text-h1 font-weight-bold mb-2"},J={class:"text-subtitle-1 text-medium-emphasis mb-4"},K={class:"text-truncate ml-2"},O={class:"system-prompt-preview"},W={key:0,class:"mt-3"},X={class:"mt-3 text-caption text-medium-emphasis"},Y={class:"text-h5 mb-2"},$={class:"text-body-1 text-medium-emphasis mb-4"},ee={class:"text-h5"},se={class:"mb-4"},te={class:"text-h6 mb-2"},ae={class:"system-prompt-content"},oe={key:0,class:"mb-4"},le={class:"text-h6 mb-2"},ie={class:"dialog-content ml-2"},ne={class:"mb-4"},re={class:"text-h6 mb-2"},de={key:0,class:"text-body-2 text-medium-emphasis"},ce={key:1,class:"d-flex flex-wrap ga-1"},me={key:2,class:"text-body-2 text-medium-emphasis"},ue={class:"text-caption text-medium-emphasis"},ge={key:0};function _e(o,n,g,l,a,u){const T=B("PersonaForm");return d(),m("div",G,[s(F,{fluid:"",class:"pa-0"},{default:e(()=>[s(b,{class:"d-flex justify-space-between align-center px-4 py-3 pb-8"},{default:e(()=>[r("div",null,[r("h1",H,[s(f,{color:"black",class:"me-2"},{default:e(()=>[c("mdi-heart")]),_:1}),c(t(l.t("core.navigation.persona")),1)]),r("p",J,t(l.tm("page.description")),1)]),r("div",null,[s(v,{color:"primary",variant:"tonal","prepend-icon":"mdi-plus",onClick:u.openCreateDialog,rounded:"xl",size:"x-large"},{default:e(()=>[c(t(l.tm("buttons.create")),1)]),_:1},8,["onClick"])])]),_:1}),s(b,null,{default:e(()=>[(d(!0),m(w,null,P(a.personas,i=>(d(),p(k,{key:i.persona_id,cols:"12",md:"6",lg:"4",xl:"3"},{default:e(()=>[s(x,{class:"persona-card",rounded:"md",onClick:_=>u.viewPersona(i)},{default:e(()=>[s(C,{class:"d-flex justify-space-between align-center"},{default:e(()=>[r("div",K,t(i.persona_id),1),s(L,{"offset-y":""},{activator:e(({props:_})=>[s(v,N({icon:"mdi-dots-vertical",variant:"text",size:"small"},_,{onClick:n[0]||(n[0]=j(()=>{},["stop"]))}),null,16)]),default:e(()=>[s(U,{density:"compact"},{default:e(()=>[s(D,{onClick:_=>u.editPersona(i)},{default:e(()=>[s(E,null,{default:e(()=>[s(f,{class:"mr-2",size:"small"},{default:e(()=>[c("mdi-pencil")]),_:1}),c(" "+t(l.tm("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),s(D,{onClick:_=>u.deletePersona(i),class:"text-error"},{default:e(()=>[s(E,null,{default:e(()=>[s(f,{class:"mr-2",size:"small"},{default:e(()=>[c("mdi-delete")]),_:1}),c(" "+t(l.tm("buttons.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s(S,null,{default:e(()=>[r("div",O,t(u.truncateText(i.system_prompt,100)),1),i.begin_dialogs&&i.begin_dialogs.length>0?(d(),m("div",W,[s(y,{size:"small",color:"secondary",variant:"tonal","prepend-icon":"mdi-chat"},{default:e(()=>[c(t(l.tm("labels.presetDialogs",{count:i.begin_dialogs.length/2})),1)]),_:2},1024)])):h("",!0),r("div",X,t(l.tm("labels.createdAt"))+": "+t(u.formatDate(i.created_at)),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128)),a.personas.length===0&&!a.loading?(d(),p(k,{key:0,cols:"12"},{default:e(()=>[s(x,{class:"text-center pa-8",elevation:"0"},{default:e(()=>[s(f,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:e(()=>[c("mdi-account-group")]),_:1}),r("h3",Y,t(l.tm("empty.title")),1),r("p",$,t(l.tm("empty.description")),1),s(v,{color:"primary",variant:"tonal","prepend-icon":"mdi-plus",onClick:u.openCreateDialog},{default:e(()=>[c(t(l.tm("buttons.createFirst")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})):h("",!0)]),_:1}),a.loading?(d(),p(b,{key:0},{default:e(()=>[(d(),m(w,null,P(6,i=>s(k,{key:i,cols:"12",md:"6",lg:"4",xl:"3"},{default:e(()=>[s(Q,{type:"card",rounded:"lg"})]),_:2},1024)),64))]),_:1})):h("",!0)]),_:1}),s(T,{modelValue:a.showPersonaDialog,"onUpdate:modelValue":n[1]||(n[1]=i=>a.showPersonaDialog=i),"editing-persona":a.editingPersona,onSaved:u.handlePersonaSaved,onError:u.showError},null,8,["modelValue","editing-persona","onSaved","onError"]),s(I,{modelValue:a.showViewDialog,"onUpdate:modelValue":n[3]||(n[3]=i=>a.showViewDialog=i),"max-width":"700px"},{default:e(()=>[a.viewingPersona?(d(),p(x,{key:0},{default:e(()=>[s(C,{class:"d-flex justify-space-between align-center"},{default:e(()=>[r("span",ee,t(a.viewingPersona.persona_id),1),s(v,{icon:"mdi-close",variant:"text",onClick:n[2]||(n[2]=i=>a.showViewDialog=!1)})]),_:1}),s(S,null,{default:e(()=>[r("div",se,[r("h4",te,t(l.tm("form.systemPrompt")),1),r("pre",ae,"                            "+t(a.viewingPersona.system_prompt)+`
                        `,1)]),a.viewingPersona.begin_dialogs&&a.viewingPersona.begin_dialogs.length>0?(d(),m("div",oe,[r("h4",le,t(l.tm("form.presetDialogs")),1),(d(!0),m(w,null,P(a.viewingPersona.begin_dialogs,(i,_)=>(d(),m("div",{key:_,class:"mb-2"},[s(y,{color:_%2===0?"primary":"secondary",variant:"tonal",size:"small",class:"mb-1"},{default:e(()=>[c(t(_%2===0?l.tm("form.userMessage"):l.tm("form.assistantMessage")),1)]),_:2},1032,["color"]),r("div",ie,t(i),1)]))),128))])):h("",!0),r("div",ne,[r("h4",re,t(l.tm("form.tools")),1),a.viewingPersona.tools===null?(d(),m("div",de,[s(y,{size:"small",color:"success",variant:"tonal","prepend-icon":"mdi-check-all"},{default:e(()=>[c(t(l.tm("form.allToolsAvailable")),1)]),_:1})])):a.viewingPersona.tools&&a.viewingPersona.tools.length>0?(d(),m("div",ce,[(d(!0),m(w,null,P(a.viewingPersona.tools,i=>(d(),p(y,{key:i,size:"small",color:"primary",variant:"tonal"},{default:e(()=>[c(t(i),1)]),_:2},1024))),128))])):(d(),m("div",me,t(l.tm("form.noToolsSelected")),1))]),r("div",ue,[r("div",null,t(l.tm("labels.createdAt"))+": "+t(u.formatDate(a.viewingPersona.created_at)),1),a.viewingPersona.updated_at?(d(),m("div",ge,t(l.tm("labels.updatedAt"))+": "+t(u.formatDate(a.viewingPersona.updated_at)),1)):h("",!0)])]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"]),s(A,{timeout:3e3,elevation:"24",color:a.messageType,modelValue:a.showMessage,"onUpdate:modelValue":n[4]||(n[4]=i=>a.showMessage=i),location:"top"},{default:e(()=>[c(t(a.message),1)]),_:1},8,["color","modelValue"])])}const ve=Z(q,[["render",_e],["__scopeId","data-v-d50c8c40"]]);export{ve as default};
