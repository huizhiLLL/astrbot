import{ac as S,a5 as C,r as b,o as d,g as u,b as s,w as a,M as D,P as I,A as r,l as p,ad as R,V as q,ae as X,af as z,C as h,e as f,t as g,p as v,$ as V,a as y,k as j,ag as Q,ah as L,ai as Y,_ as F,a1 as B,L as x,a2 as T,N as E,a0 as Z,aj as K,F as W,u as J,Q as $,ak as ee,al as M,am as N,h as te,an as oe}from"./index-77b120c5.js";import{A as U}from"./AstrBotConfig-6cbf92d7.js";import{W as se}from"./WaitingForRestart-fc0333aa.js";import{C as ae}from"./ConsoleDisplayer-dd1d5724.js";import{I as ie}from"./ItemCard-d3e0f569.js";import{A as le,C as ne}from"./ConfigPage-fdf807d1.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import{u as re}from"./common-6d6e5a4f.js";import"./index-27248cb2.js";import"./KnowledgeBaseSelector-f63d1cc5.js";import"./PersonaForm-6a4b8a9f.js";import"./toast-0c57477c.js";function H(e){if(e==="aiocqhttp"||e==="qq_official"||e==="qq_official_webhook")return new URL("/assets/qq-7a369eaf.png",self.location).href;if(e==="wecom"||e==="wecom_ai_bot")return new URL("/assets/wecom-7dfcf4e4.png",self.location).href;if(e==="wechatpadpro"||e==="weixin_official_account"||e==="wechat")return new URL("/assets/wechat-6a207b66.png",self.location).href;if(e==="lark")return new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArwAAAK8BAMAAAD/lHFwAAAAD1BMVEVHcEwkgd8A1Lgzb/8TPJni6nOaAAAAAnRSTlMAcCaWvAQAAAz7SURBVHja7Z1rbhu5FgbZGi+gW/YC7MALaIKzAAni/td0cxNnYid+SN08PA9W/boYjDNA4bt1KCeIUwIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAuEzfjPC0YFeWeIIPlvR+e5qD6f1mjBm9+PWr9wm9+L2W4zfyMMzLgfl24JHPFaLwwYL5+s1DqPpOPB4Gy0OoOhjMA9+VZL5+8xDrOw/28jCTB+rgNw+JPFAHt3kIdtzM5SGY3sRxGykP0epg7brN5IE6+L1uiTxQB7fXLVwdjOUhnN5EHcbJw1O8+R6pwzB5iFcHU9ftiflSB7/XLWAdLF23iHVI1GGU6zYzX+rg97pF1Gvous3Mlzr4vW4h9SbqMMZ8H2PO90gdhrhuM/OlDm6v21NQvQfiO8J8H5kvdfB73aLqnXiaDTDfR+ZLHfxet7B6E3WIP98n5ksd/M53juv3SHyjP84Cx9fEfBPzpQ5u5/vEfKmD3/nOkf0S3+CfLSLH18J8E/Mlvm7n+8h8ia/f+SbmS3zdzveR+RJfv/NNzJf4up3vI/Mlvn7nm5gv8XU735n5ctvczjf8bVOeb2K+xNftfB+ZL/H1O9/EfNHrdr6PzBe9buc7wG1TnW9ivnywcDvfEeKr+Od9h4jvhN6g803Ml9vmdr6PzBe9buc7xm3T+2gxht7EbQs530fmi1638x3ktqnNdxS9R/QG/GgxM19um9v5DnPbdOY7jt4Dty3e22xmvtw2t/MdSO+R2xbubZaYL3rdznceyC+3LdrbbCS9iadDsOM2lN6Jp0Ow+Y70dFA4bkPpTTwdYs13LL2Jp0Os4zaW3gm9oeY71tOh+3H7WO+yLA8PD7XW8/n7/5w4bs2eDstS32NZqMNevctD/YzFeU0mzZfZF25/cp6Z74anw7TUa9ldiUnt/wUHHb3TQ72FfROeSiljHLefmqZ6M3sE33/Xuw4x3/n25e4XXIrefKfOT4eNcn8I3qN3HeG4PW6Xu/nITUVzvl3rUHeypRAvetfwx+257mfZqjf8fGsTbh7wL71z6OP2XFsxb9ObIx+32pDzJr1a8z04s3uj3//05qjH7bm2Zt6gN+p829u9xe9vvTnkcZOwe4Pf33q15nv0k93bA/xKb45Xh+eq7PeVXq35+tvu9X5f683B6vBsS6/SfCeH2732ur3RmyPVQXS7W9qrNd+Dv+1e+zR7qzeHqYPsdrc8zPTme/Rm9+rPFX/ozTHqIG336m/r/KFXab7O7G76UKw436Ors1Zr2qpXZ76TL7un7Xqz+zo82xnv33p15nvwZPe0R2/2XQd5u9t+t0J3vkc34b3pN9ve0Zs916GaGu97enXm6yYNNe3UW/zWoYPd0269q9c6VGPjfV9vcVqHHmk4N9Drc7497N74h8ze16sx38lFGmpqoXd1WIcu4z010Vv81eHZ4Hg/1Lu6q0MXu+dGejU+WzgY76mV3uyrDn3s1tRKr7P5VpNt+ESvwnyP1sc7t9OrMN+D8fHW1FBv8VOHTuM9NdW7uqlDNdqGT/UWL3WoVtvwud7VSR2q1TZ8rrf/dTtaHu/cWm/2UIdnu234Qm//+Roe76m93my/Ds+G2/CV3u7X7WB2vFva8KXeYr0O3cZ7FtG7Gq9DtdyGr/X2nu9kdLw1yejNputQTbfhCr29H2dHm+M9SenNhutQbaf3Gr29r5vJ8dYkpreYrUM13obr9Pad78HieGdBvZ2vm8Hx1iSpN5usQ8fxnkX19s3Dwd54T7J6i8E6dBzv1vRerXe1V4dqP71X6+163Q7WxnsW15ut1aE6SO/1ervO92hrvJvTe4PeYqsO1UN6b9GbLdWh63jPPfT2zMPR1HhPXfRmO3XoOt7t6b1Jb8fH72RpvDX10VusxLfveM+99GYjdahO0nuj3n7XbbIz3h3pvVVvMVGH6iW9N+vNBurQebznjnq75WGyYndPem/Xm9Xr0Fvv3FNvt8fv0Uh5a+qqt1ceDkbGe+6sN6vWobfdXel9+WGOJvNwtKF37q23Ux4OJspbU3e9ffIwmRjvub/eTnmwYHdnerfp7ZOHgwW9s4berFOH/nZ3pnej3j55MKD3rKO3Sx6O+uM9KenNCvFV0Dsr6e2SB3W7e9O7XW+PPBy19Z719ObOddAY70lPb4c8TNp6Z0W9HfKgbHd3enfpzT3roKH3rKpX3u+kO96Trl75POjqnZX1iv+5h6Om3f3p3as3d4qvit6zul7p19mkOd6Tvl7p/GrqnQ3ozR3qoGO3QXr36xX2O6n8/mWr9DbQK5wHvfGebOiVfZ0dtcbbIr1N9GbZ+CqNt0V6m+gVfZ1NWuM9m9Erml+t8Z7s6JXMb3Wc3lZ65fJ7Vx2nt5VeufxWz+ltplcqv2rjPdnSW2KNt016G+oVye9DdZ3ehnol8jtV3+ltqVcgv3rjPdnTW+KMt1F62+rNYcbbKL1t9Tb2e1e9p7ex3rb51bPbKr2t9bb0qzjeVultrrdEuGvN0ttebw5w15qlt73eVn5Vx3uyq7dRfjXtNkuvhN4mfu9qhPSK6C3O09AuvTJ6s+u71jC9Mnp3+9VNQ7v0Cund+81JXbvt0iuld995001Dw/SK6d3jd1Ie78mB3uI2DQ3TK6g3O71rLdMrqHerX+00tEyvpN6Nzwdtuy3TK6p303l7qIHSK6t3g1/1NDRNr7De2/3q2z070lvcpaFpesX1Zm9paJpecb23+TVgt2l65fXe4tdAGtqmt4Pe6/3eWRjvyZveaz9eWAhv4zZ00Xvl86yiV9DvQ43Xhk56r/B7Z2O8s0u9X/q1Ed7Wbeim9yu/Ruyever93O+DEb0nt3o/82skvM3T21NvNh/e5untqfdjv2bsnj3r/cjvgxm9q2u97/u1Y7d5ejvrfc/vnR27l+Rc799+7Zw1gTZ01/unX0t227ehv94//Fqy274NCnrf+H2wpDeH0PvKrym7AulV0fufX1t2L3MQvS9+70zZlWiDkt4f398xZleiDWp6yzwZsyvRBj29xZjdKvJXWRX8vow3B9Nry6/M33Onqbf8G70NunoN+ZVpg7JeO37LGlGvFb8Xob8Cs+D3x3hzUL0mHhAXoTZY0GvAr9jfTl7w+//x5sh6S9Q2GNGre+Aucj8ZouBXsA1m9CoG4lLE2mBIbwnYBkt6i5pduR9qYkmvToCLYBts6dXw+328gj/xqBhDY7x5HL1FYbzrQHo7B6KItsGg3q5+L7JtsKi3YyAuL3+iZSy9pWcaRH9QrU29nQJxKcJtsKq3z4CLdBvs6u0w4CLeBsN6xf3+SIPko9e2XuFA/LQr/BPuy7B+f/4XRA+bdb2CgXgZ7zq0XrEBv9iVPWwO9MoM+JfdPLxekQH/+qVn9AoMuHQarw+9rQf8Kw3Sh82N3qYD/s+u9GHzo7fhgH/bzehtPuDfdsUPmyu9bQb8yq58G3zpbTDg13ZX9DYW/Npuh/G607uvEG/sZvS2HfDbX2dGb1PBb3+RHuP1qXdTIS5//BIrehsK/usXSOhtVojLX1++oreZ4He+eEZvI8HvfWWXw+Zd7zWC3/+6Gb0Njtzlg6/pNN4Iej82/PEXrOi9sRJvM3G5fPpvJ/QKsqJXkoTeCOMdU++MXkFyQm+I8SbGi163402MF71ux5sYL3rdjjcxXvS6HW9ivOh1O97EeNHrdryJ8aLX7XgT40Wv2/Emxotet+NNjBe9bsc7jt41oVeQhN5w402MF71O79owenNCb8DxJsaLXqd3bRC9K3pjjncEvbOi3nvuGnqdpmEAvauq3n9IA3p93rXvTIwXvT7vWviH76yu9540cNucpiF0fGcDehNpIL5O0xA4vrMNvRNpoA5O0xC1DrMZvYk0MF+3dgPOdzalN9p815SY7yBpCPf2Tea4J7z4dRneWHnIKeF3pPBGep3NVvWGyK9duxFev9mwXf/5NW3Xv99knH8IL+fNrV3Pfj3Y9ft8yC7sej1vTuw69evGrku/jux69Dt70uvu+eDLrje/3uz68uvPrie/Hu368evTrhe/Xu368OvXrge/nu3a9+vbrnW/3u3a9uvfrmW/EeymtGB3vO+f5RSGCbtj+V1TLGwduCUl/HLUPD4gckS7ZgKcU1Cme7IbPMBzisxEGOIGYknxWXgxRBzwkkZhYbqxBryksViYbpQ38IBy+xViSaOy0AXXgseWKywYuYKCkSsoGLlvBLd9RSzIFXum5QWbYo1guJ9MeKG4Vg3jVuzQZZpw44jvUSu94q8cLwuvhP2Sv3OfX821/PhHmAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA3/A+Tx3VJ8et+jwAAAABJRU5ErkJggg==",self.location).href;if(e==="dingtalk")return new URL("/assets/dingtalk-c6437bfa.svg",self.location).href;if(e==="telegram")return new URL("/assets/telegram-e782a1bf.svg",self.location).href;if(e==="discord")return new URL("/assets/discord-a137e6ae.svg",self.location).href;if(e==="slack")return new URL("/assets/slack-c0af31c6.svg",self.location).href;if(e==="kook")return new URL("data:image/png;base64,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",self.location).href;if(e==="vocechat")return new URL("/assets/vocechat-77bce3e6.png",self.location).href;if(e==="satori"||e==="Satori")return new URL("/assets/satori-7f1988af.png",self.location).href;if(e==="misskey")return new URL("/assets/misskey-9f74289e.png",self.location).href}function de(e){return{qq_official_webhook:"https://docs.astrbot.app/deploy/platform/qqofficial/webhook.html",qq_official:"https://docs.astrbot.app/deploy/platform/qqofficial/websockets.html",aiocqhttp:"https://docs.astrbot.app/deploy/platform/aiocqhttp/napcat.html",wecom:"https://docs.astrbot.app/deploy/platform/wecom.html",wecom_ai_bot:"https://docs.astrbot.app/deploy/platform/wecom_ai_bot.html",lark:"https://docs.astrbot.app/deploy/platform/lark.html",telegram:"https://docs.astrbot.app/deploy/platform/telegram.html",dingtalk:"https://docs.astrbot.app/deploy/platform/dingtalk.html",wechatpadpro:"https://docs.astrbot.app/deploy/platform/wechat/wechatpadpro.html",weixin_official_account:"https://docs.astrbot.app/deploy/platform/weixin-official-account.html",discord:"https://docs.astrbot.app/deploy/platform/discord.html",slack:"https://docs.astrbot.app/deploy/platform/slack.html",kook:"https://docs.astrbot.app/deploy/platform/kook.html",vocechat:"https://docs.astrbot.app/deploy/platform/vocechat.html",satori:"https://docs.astrbot.app/deploy/platform/satori/llonebot.html",misskey:"https://docs.astrbot.app/deploy/platform/misskey.html"}[e]||"https://docs.astrbot.app"}function fe(e,t){return t.includes("vocechat")?"由 @HikariFroya 提供。":t.includes("kook")?"由 @wuyan1003 提供。":""}const ce={name:"AddNewPlatform",components:{AstrBotConfig:U,AstrBotCoreConfigWrapper:le,ConfigPage:ne},emits:["update:show","show-toast","refresh-config"],props:{show:{type:Boolean,default:!1},metadata:{type:Object,default:()=>({})},config_data:{type:Object,default:()=>({})},updatingMode:{type:Boolean,default:!1},updatingPlatformConfig:{type:Object,default:null}},data(){return{selectedPlatformType:null,selectedPlatformConfig:null,aBConfigRadioVal:"0",selectedAbConfId:"default",configInfoList:[],selectedConfigData:null,selectedConfigMetadata:null,configPreviewLoading:!1,newConfigData:null,newConfigMetadata:null,newConfigLoading:!1,platformConfigs:[],configTableHeaders:[{title:"与此实例关联的配置文件 ID",key:"name",sortable:!1},{title:"在此实例下的应用范围",key:"scope",sortable:!1}],platformRoutes:[],routeTableHeaders:[{title:"消息会话来源(消息类型:会话 ID)",key:"source",sortable:!1,width:"60%"},{title:"使用配置文件",key:"configId",sortable:!1,width:"20%"},{title:"操作",key:"actions",sortable:!1,align:"center",width:"20%"}],messageTypeOptions:[{label:"全部消息",value:"*"},{label:"群组消息(GroupMessage)",value:"GroupMessage"},{label:"私聊消息(FriendMessage)",value:"FriendMessage"}],isEditingRoutes:!1,showIdConflictDialog:!1,conflictId:"",idConflictResolve:null,showOneBotEmptyTokenWarnDialog:!1,oneBotEmptyTokenWarningResolve:null,loading:!1,showConfigSection:!1,showConfigDrawer:!1,configDrawerTargetId:null}},setup(){const{tm:e}=S("features/platform");return{tm:e}},computed:{showDialog:{get(){return this.show},set(e){this.$emit("update:show",e)}},platformTemplates(){var e,t,i;return((i=(t=(e=this.metadata.platform_group)==null?void 0:e.metadata)==null?void 0:t.platform)==null?void 0:i.config_template)||{}},canSave(){return this.selectedPlatformType?this.aBConfigRadioVal==="0"?!!this.selectedAbConfId:this.aBConfigRadioVal==="1"?!!(this.selectedAbConfId&&this.newConfigData):!1:!1}},watch:{selectedPlatformType(e){e&&this.platformTemplates[e]?this.selectedPlatformConfig=JSON.parse(JSON.stringify(this.platformTemplates[e])):this.selectedPlatformConfig=null},selectedAbConfId(e){!this.updatingMode&&this.aBConfigRadioVal==="0"&&e?this.getConfigForPreview(e):(this.selectedConfigData=null,this.selectedConfigMetadata=null)},aBConfigRadioVal(e){e==="1"?(this.selectedConfigData=null,this.selectedConfigMetadata=null,this.selectedAbConfId=null,this.getDefaultConfigTemplate()):e==="0"&&(this.newConfigData=null,this.newConfigMetadata=null,this.selectedAbConfId||(this.selectedAbConfId="default"))},showIdConflictDialog(e){!e&&this.idConflictResolve&&(this.idConflictResolve(!1),this.idConflictResolve=null)},showOneBotEmptyTokenWarnDialog(e){!e&&this.oneBotEmptyTokenWarningResolve&&(this.oneBotEmptyTokenWarningResolve(!0),this.oneBotEmptyTokenWarningResolve=null)},updatingPlatformConfig:{handler(e){this.updatingMode&&e&&e.id&&this.getPlatformConfigs(e.id)},immediate:!0},showConfigSection(e){e&&!this.updatingMode&&this.aBConfigRadioVal==="0"&&this.getConfigForPreview(this.selectedAbConfId),e&&this.$nextTick(()=>{this.scrollDialogToBottom()})},updatingMode:{handler(e){e&&(this.showConfigSection=!0,this.isEditingRoutes=!1)},immediate:!0}},methods:{getPlatformIcon:H,getPlatformDescription:fe,resetForm(){this.selectedPlatformType=null,this.selectedPlatformConfig=null,this.aBConfigRadioVal="0",this.selectedAbConfId="default",this.selectedConfigData=null,this.selectedConfigMetadata=null,this.configPreviewLoading=!1,this.newConfigData=null,this.newConfigMetadata=null,this.newConfigLoading=!1,this.showConfigSection=!1,this.isEditingRoutes=!1,this.showConfigDrawer=!1,this.configDrawerTargetId=null},closeDialog(){this.resetForm(),this.showDialog=!1},async getConfigInfoList(){await C.get("/api/config/abconfs").then(e=>{this.configInfoList=e.data.data.info_list})},async getConfigForPreview(e){if(!e){this.selectedConfigData=null,this.selectedConfigMetadata=null;return}this.configPreviewLoading=!0;try{const t=await C.get("/api/config/abconf",{params:{id:e}});this.selectedConfigData=t.data.data.config,this.selectedConfigMetadata=t.data.data.metadata}catch(t){console.error("获取配置文件预览数据失败:",t),this.selectedConfigData=null,this.selectedConfigMetadata=null}finally{this.configPreviewLoading=!1}},async getDefaultConfigTemplate(){this.newConfigLoading=!0;try{const e=await C.get("/api/config/default");this.newConfigData=e.data.data.config,this.newConfigMetadata=e.data.data.metadata}catch(e){console.error("获取默认配置模板失败:",e),this.newConfigData=null,this.newConfigMetadata=null}finally{this.newConfigLoading=!1}},openTutorial(){const e=de(this.selectedPlatformConfig.type);window.open(e,"_blank")},openConfigDrawer(e){const t=e||"default";e&&this.configInfoList.findIndex(i=>i.id===e)===-1&&this.showError("目标配置文件不存在，已打开配置页面以便检查。"),this.configDrawerTargetId=t,this.showConfigDrawer=!0},closeConfigDrawer(){this.showConfigDrawer=!1},newPlatform(){if(this.loading=!0,this.updatingMode){if(this.updatingPlatformConfig.type==="aiocqhttp"){const e=this.updatingPlatformConfig.ws_reverse_token;if(!e||e.trim()===""){this.showOneBotEmptyTokenWarning().then(t=>{t?this.updatePlatform():this.loading=!1});return}}this.updatePlatform()}else this.savePlatform()},async updatePlatform(){var t,i;let e=this.updatingPlatformConfig.id;if(!e){this.loading=!1,this.showError("更新失败，缺少平台 ID。");return}try{await C.post("/api/config/platform/update",{id:e,config:this.updatingPlatformConfig}),await this.saveRoutesInternal(),this.loading=!1,this.showDialog=!1,this.resetForm(),this.$emit("refresh-config"),this.showSuccess("更新成功")}catch(l){this.loading=!1,this.showError(((i=(t=l.response)==null?void 0:t.data)==null?void 0:i.message)||l.message)}},async savePlatform(){var t,i,l;if((((t=this.config_data.platform)==null?void 0:t.find(o=>o.id===this.selectedPlatformConfig.id))||this.selectedPlatformConfig.id==="webchat")&&!await this.confirmIdConflict(this.selectedPlatformConfig.id)){this.loading=!1;return}if(this.selectedPlatformConfig.type==="aiocqhttp"){const o=this.selectedPlatformConfig.ws_reverse_token;if((!o||o.trim()==="")&&!await this.showOneBotEmptyTokenWarning())return}try{const o=await C.post("/api/config/platform/new",this.selectedPlatformConfig);await this.handleConfigFile(),this.loading=!1,this.showDialog=!1,this.resetForm(),this.$emit("refresh-config"),this.showSuccess(o.data.message||"平台添加成功，配置文件已更新")}catch(o){this.loading=!1,this.showError(((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.message)||o.message)}},async handleConfigFile(){if(!this.selectedAbConfId)return;const t=`${this.selectedPlatformConfig.id}:*:*`;let i=null;if(this.aBConfigRadioVal==="0"?i=this.selectedAbConfId:this.aBConfigRadioVal==="1"&&(i=await this.createNewConfigFile(this.selectedAbConfId)),!i)throw new Error("无法获取配置文件ID");await this.updateRoutingTable(t,i)},async updateRoutingTable(e,t){var i,l;try{await C.post("/api/config/umo_abconf_route/update",{umo:e,conf_id:t}),console.log(`成功更新路由表: ${e} -> ${t}`)}catch(o){throw console.error("更新路由表失败:",o),new Error(`更新路由表失败: ${((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.message)||o.message}`)}},async createNewConfigFile(e){var t,i;try{const l=this.aBConfigRadioVal==="1"&&this.newConfigData?this.newConfigData:void 0,n=(await C.post("/api/config/abconf/new",{name:e,config:l})).data.data.conf_id;return console.log(`成功创建新配置文件 ${e}，ID: ${n}`),n}catch(l){throw console.error("创建新配置文件失败:",l),new Error(`创建新配置文件失败: ${((i=(t=l.response)==null?void 0:t.data)==null?void 0:i.message)||l.message}`)}},confirmIdConflict(e){return this.conflictId=e,this.showIdConflictDialog=!0,new Promise(t=>{this.idConflictResolve=t})},handleIdConflictConfirm(e){this.idConflictResolve&&this.idConflictResolve(e),this.showIdConflictDialog=!1},showOneBotEmptyTokenWarning(){return this.showOneBotEmptyTokenWarnDialog=!0,new Promise(e=>{this.oneBotEmptyTokenWarningResolve=e})},handleOneBotEmptyTokenWarningDismiss(e){this.showOneBotEmptyTokenWarnDialog=!1,this.oneBotEmptyTokenWarningResolve&&(this.oneBotEmptyTokenWarningResolve(e),this.oneBotEmptyTokenWarningResolve=null),e||(this.loading=!1)},showSuccess(e){this.$emit("show-toast",{message:e,type:"success"})},showError(e){this.$emit("show-toast",{message:e,type:"error"})},async getPlatformConfigs(e){if(!e){this.platformRoutes=[];return}try{const i=(await C.get("/api/config/umo_abconf_routes")).data.data.routing,l=[];for(const[o,n]of Object.entries(i))if(this.isUmopMatchPlatform(o,e)){const w=o.split(":");w.length===3&&l.push({umop:o,originalUmop:o,messageType:w[1]===""||w[1]==="*"?"*":w[1],sessionId:w[2]===""||w[2]==="*"?"*":w[2],configId:n})}this.platformRoutes=l,this.platformRoutes.length===0&&this.platformRoutes.push({umop:null,originalUmop:null,messageType:"*",sessionId:"*",configId:"default"})}catch(t){console.error("获取平台路由配置失败:",t),this.platformRoutes=[]}},addNewRoute(){this.platformRoutes.push({umop:null,originalUmop:null,messageType:"*",sessionId:"*",configId:"default"})},deleteRoute(e){this.platformRoutes.splice(e,1)},moveRouteUp(e){if(e>0){const t=this.platformRoutes[e];this.platformRoutes[e]=this.platformRoutes[e-1],this.platformRoutes[e-1]=t,this.platformRoutes=[...this.platformRoutes]}},moveRouteDown(e){if(e<this.platformRoutes.length-1){const t=this.platformRoutes[e];this.platformRoutes[e]=this.platformRoutes[e+1],this.platformRoutes[e+1]=t,this.platformRoutes=[...this.platformRoutes]}},async saveRoutesInternal(){var e,t;if(!this.updatingPlatformConfig||!this.updatingPlatformConfig.id)throw new Error("无法获取平台 ID");try{const l=(await C.get("/api/config/umo_abconf_routes")).data.data.routing,o=this.updatingPlatformConfig.id;for(const n in l)this.isUmopMatchPlatform(n,o)&&delete l[n];for(const n of this.platformRoutes){const w=n.messageType==="*"?"*":n.messageType,_=n.sessionId==="*"?"*":n.sessionId,k=`${o}:${w}:${_}`;n.configId&&(l[k]=n.configId)}await C.post("/api/config/umo_abconf_route/update_all",{routing:l})}catch(i){throw console.error("保存路由表失败:",i),new Error(`保存路由表失败: ${((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||i.message}`)}},toggleEditMode(){this.isEditingRoutes=!this.isEditingRoutes},toggleConfigSection(){this.showConfigSection=!this.showConfigSection},getConfigName(e){const t=this.configInfoList.find(i=>i.id===e);return t?t.name:e},isUmopMatchPlatform(e,t){if(!e)return!1;const i=e.split(":");if(i.length!==3)return!1;const l=i[0];return l===t||l===""||l==="*"},getMessageTypeLabel(e){return{"*":"全部消息","":"全部消息",GroupMessage:"群组消息",FriendMessage:"私聊消息"}[e]||e},toggleShowConfigSection(){this.showConfigSection=!1,this.showConfigSection=!0},prepareData(){this.getConfigInfoList(),this.getConfigForPreview(this.selectedAbConfId),this.updatingMode&&this.updatingPlatformConfig&&this.updatingPlatformConfig.id&&this.getPlatformConfigs(this.updatingPlatformConfig.id)},scrollDialogToBottom(){const e=this.$refs.dialogScrollContainer,t=(e==null?void 0:e.$el)||e;if(!t)return;const i={top:t.scrollHeight,behavior:"smooth"};typeof t.scrollTo=="function"?t.scrollTo(i):t.scrollTop=t.scrollHeight}}},ge={class:"d-flex align-start",style:{width:"100%"}},me={style:{flex:"1"}},ue=r("h3",null," 选择消息平台类别 ",-1),he=r("small",{style:{color:"grey"}},"想把机器人接入到哪里？如 QQ、企业微信、飞书、Discord、Telegram 等。",-1),pe={key:0},Ae=["src"],we={key:0,class:"mt-3"},Ce={class:"mt-2"},ve={key:1},ye={class:"mt-3"},be={class:"mt-2"},_e={class:"d-flex align-start mt-6"},ke={style:{flex:"1"}},De={class:"d-flex align-center justify-space-between"},Pe={class:"d-flex align-center"},Re=r("h3",null," 配置文件 ",-1),Ie=r("small",{style:{color:"grey"}},"想如何配置机器人？配置文件包含了聊天模型、人格、知识库、插件范围等丰富的机器人配置项。",-1),xe={key:0,style:{color:"grey"}},Ve={key:0},Be={key:0},Te=r("span",null,"使用现有配置文件",-1),Me={key:0,class:"d-flex align-center ml-10 my-2"},Ee={key:1,class:"d-flex align-center"},Oe={key:0,class:"mt-4"},Le={key:0,class:"d-flex justify-center py-4"},Ne={key:1,class:"config-preview-container"},Se=r("h4",{class:"mb-3"},"使用新的配置文件",-1),We={key:2,class:"text-center py-4 text-grey"},Ue=r("p",{class:"mt-2"},"无法加载默认配置模板",-1),Ge={key:1},He={class:"mb-3 d-flex align-center justify-space-between"},qe={class:"d-flex align-center",style:{"min-width":"250px"}},Xe={key:1},ze=r("small",{class:"mx-1"},":",-1),je={key:3},Qe={class:"d-flex align-center"},Ye={key:1},Fe={key:0,style:{color:"red"},class:"ml-2"},Ze={key:0,class:"d-flex align-center"},Ke={key:1,class:"text-grey"},Je=r("small",{class:"ml-2 mt-2 d-block",style:{color:"grey"}},"*消息下发时，根据会话来源按顺序从上到下匹配首个符合条件的配置文件。使用 * 表示匹配所有。使用 /sid 指令获取会话 ID。全部不匹配时将使用默认配置文件。",-1),$e={href:"https://docs.astrbot.app/deploy/platform/aiocqhttp/napcat.html#%E9%99%84%E5%BD%95-%E5%A2%9E%E5%BC%BA%E8%BF%9E%E6%8E%A5%E5%AE%89%E5%85%A8%E6%80%A7",target:"_blank"},et={class:"config-drawer-header"},tt=r("span",{class:"text-h6"},"配置文件管理",-1),ot={key:0,class:"text-caption text-grey"},st={class:"config-drawer-content"};function at(e,t,i,l,o,n){const w=b("AstrBotConfig"),_=b("AstrBotCoreConfigWrapper"),k=b("ConfigPage");return d(),u(W,null,[s(T,{modelValue:n.showDialog,"onUpdate:modelValue":t[6]||(t[6]=m=>n.showDialog=m),"max-width":"800px",height:"90%",onAfterEnter:n.prepareData},{default:a(()=>[s(D,{title:i.updatingMode?`${l.tm("dialog.edit")} ${i.updatingPlatformConfig.id} ${l.tm("dialog.adapter")}`:l.tm("dialog.addPlatform")},{default:a(()=>[s(I,{ref:"dialogScrollContainer",class:"pa-4 ml-2",style:{"overflow-y":"auto"}},{default:a(()=>{var m,P;return[r("div",ge,[r("div",null,[s(p,{icon:"mdi-numeric-1-circle",class:"mr-3"})]),r("div",me,[ue,he,r("div",null,[i.updatingMode?(d(),u("div",ve,[s(V,{label:"消息平台类别",variant:"outlined",rounded:"md",dense:"","hide-details":"",class:"mt-6",style:{"max-width":"30%","min-width":"300px"},modelValue:i.updatingPlatformConfig.type,"onUpdate:modelValue":t[1]||(t[1]=c=>i.updatingPlatformConfig.type=c),disabled:""},null,8,["modelValue"]),r("div",ye,[r("div",be,[s(w,{iterable:i.updatingPlatformConfig,metadata:(P=i.metadata.platform_group)==null?void 0:P.metadata,metadataKey:"platform"},null,8,["iterable","metadata"])])])])):(d(),u("div",pe,[s(R,{modelValue:o.selectedPlatformType,"onUpdate:modelValue":t[0]||(t[0]=c=>o.selectedPlatformType=c),items:Object.keys(n.platformTemplates),"item-title":"name","item-value":"name",label:"消息平台类别",variant:"outlined",rounded:"md",dense:"","hide-details":"",class:"mt-6",style:{"max-width":"30%","min-width":"300px"}},{item:a(({props:c,item:A})=>[s(q,X(z(c)),{prepend:a(()=>[r("img",{src:n.getPlatformIcon(n.platformTemplates[A.raw].type),style:{width:"32px",height:"32px","object-fit":"contain","margin-right":"16px"}},null,8,Ae)]),_:2},1040)]),_:1},8,["modelValue","items"]),o.selectedPlatformConfig?(d(),u("div",we,[s(h,{color:"info",variant:"tonal",onClick:n.openTutorial,class:"mt-2"},{default:a(()=>[s(p,{start:""},{default:a(()=>[f("mdi-book-open-variant")]),_:1}),f(" "+g(l.tm("dialog.viewTutorial")),1)]),_:1},8,["onClick"]),r("div",Ce,[s(w,{iterable:o.selectedPlatformConfig,metadata:(m=i.metadata.platform_group)==null?void 0:m.metadata,metadataKey:"platform"},null,8,["iterable","metadata"])])])):v("",!0)]))])])]),r("div",_e,[r("div",null,[s(p,{icon:"mdi-numeric-2-circle",class:"mr-3"})]),r("div",ke,[r("div",De,[r("div",null,[r("div",Pe,[Re,i.updatingMode?v("",!0):(d(),y(j,{key:0,size:"x-small",color:"primary",variant:"tonal",rounded:"sm",class:"ml-2"},{default:a(()=>[f("可选")]),_:1}))]),Ie,i.updatingMode?v("",!0):(d(),u("small",xe,"默认使用默认配置文件 “default”。您也可以稍后配置。"))]),r("div",null,[s(h,{variant:"plain",icon:"",onClick:n.toggleConfigSection,class:"mt-2"},{default:a(()=>[s(p,null,{default:a(()=>[f(g(o.showConfigSection?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1},8,["onClick"])])]),o.showConfigSection?(d(),u("div",Ve,[i.updatingMode?(d(),u("div",Ge,[r("div",He,[r("div",null,[o.isEditingRoutes?(d(),y(h,{key:0,color:"primary",variant:"tonal",onClick:n.addNewRoute,size:"small"},{default:a(()=>[s(p,{start:""},{default:a(()=>[f("mdi-plus")]),_:1}),f(" 添加路由规则 ")]),_:1},8,["onClick"])):v("",!0)]),s(h,{color:o.isEditingRoutes?"grey":"primary",variant:"tonal",size:"small",onClick:n.toggleEditMode},{default:a(()=>[s(p,{start:""},{default:a(()=>[f(g(o.isEditingRoutes?"mdi-eye":"mdi-pencil"),1)]),_:1}),f(" "+g(o.isEditingRoutes?"查看":"编辑"),1)]),_:1},8,["color","onClick"])]),s(F,{headers:o.routeTableHeaders,items:o.platformRoutes,"item-value":"umop","no-data-text":"该平台暂无路由规则，将使用默认配置文件","hide-default-footer":"","items-per-page":-1,class:"mt-2",variant:"outlined"},{"item.source":a(({item:c})=>[r("div",qe,[o.isEditingRoutes?(d(),y(R,{key:0,modelValue:c.messageType,"onUpdate:modelValue":A=>c.messageType=A,items:o.messageTypeOptions,"item-title":"label","item-value":"value",variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"140px"}},null,8,["modelValue","onUpdate:modelValue","items"])):(d(),u("small",Xe,g(n.getMessageTypeLabel(c.messageType)),1)),ze,o.isEditingRoutes?(d(),y(V,{key:2,modelValue:c.sessionId,"onUpdate:modelValue":A=>c.sessionId=A,variant:"outlined",density:"compact","hide-details":"",placeholder:"会话ID或*"},null,8,["modelValue","onUpdate:modelValue"])):(d(),u("small",je,g(c.sessionId==="*"?"全部会话":c.sessionId),1))])]),"item.configId":a(({item:c})=>[r("div",Qe,[o.isEditingRoutes?(d(),y(R,{key:0,modelValue:c.configId,"onUpdate:modelValue":A=>c.configId=A,items:o.configInfoList,"item-title":"name","item-value":"id",variant:"outlined",density:"compact",style:{"min-width":"200px"},"hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):(d(),u("div",Ye,[r("small",null,g(n.getConfigName(c.configId)),1)])),s(h,{icon:"",variant:"text",density:"compact",class:"ml-2",disabled:!c.configId,onClick:A=>n.openConfigDrawer(c.configId)},{default:a(()=>[s(p,{size:"18"},{default:a(()=>[f("mdi-arrow-top-right-thick")]),_:1})]),_:2},1032,["disabled","onClick"])]),o.configInfoList.findIndex(A=>A.id===c.configId)===-1?(d(),u("small",Fe,"配置文件不存在")):v("",!0)]),"item.actions":a(({item:c,index:A})=>[o.isEditingRoutes?(d(),u("div",Ze,[s(h,{icon:"",size:"x-small",variant:"text",onClick:O=>n.moveRouteUp(A),disabled:A===0},{default:a(()=>[s(p,null,{default:a(()=>[f("mdi-arrow-up")]),_:1})]),_:2},1032,["onClick","disabled"]),s(h,{icon:"",size:"x-small",variant:"text",onClick:O=>n.moveRouteDown(A),disabled:A===o.platformRoutes.length-1},{default:a(()=>[s(p,null,{default:a(()=>[f("mdi-arrow-down")]),_:1})]),_:2},1032,["onClick","disabled"]),s(h,{icon:"",size:"x-small",variant:"text",color:"error",onClick:O=>n.deleteRoute(A)},{default:a(()=>[s(p,null,{default:a(()=>[f("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])):(d(),u("span",Ke,"-"))]),_:1},8,["headers","items"]),Je])):(d(),u("div",Be,[s(Q,{class:"mt-2",modelValue:o.aBConfigRadioVal,"onUpdate:modelValue":t[5]||(t[5]=c=>o.aBConfigRadioVal=c),"hide-details":"true"},{default:a(()=>[s(L,{value:"0"},{label:a(()=>[Te]),_:1}),o.aBConfigRadioVal==="0"?(d(),u("div",Me,[s(R,{modelValue:o.selectedAbConfId,"onUpdate:modelValue":t[2]||(t[2]=c=>o.selectedAbConfId=c),items:o.configInfoList,"item-title":"name","item-value":"id",label:"选择配置文件",variant:"outlined",rounded:"md",dense:"","hide-details":"",style:{"max-width":"30%","min-width":"200px"}},null,8,["modelValue","items"]),s(h,{icon:"",variant:"text",density:"comfortable",class:"ml-2",disabled:!o.selectedAbConfId,onClick:t[3]||(t[3]=c=>n.openConfigDrawer(o.selectedAbConfId))},{default:a(()=>[s(p,null,{default:a(()=>[f("mdi-arrow-top-right-thick")]),_:1})]),_:1},8,["disabled"])])):v("",!0),s(L,{value:"1",label:"创建新配置文件"}),o.aBConfigRadioVal==="1"?(d(),u("div",Ee,[s(V,{modelValue:o.selectedAbConfId,"onUpdate:modelValue":t[4]||(t[4]=c=>o.selectedAbConfId=c),label:"新配置文件名称",variant:"outlined",rounded:"md",dense:"","hide-details":"",style:{"max-width":"30%","min-width":"200px"},class:"ml-10 my-2"},null,8,["modelValue"])])):v("",!0)]),_:1},8,["modelValue"]),o.aBConfigRadioVal==="1"?(d(),u("div",Oe,[o.newConfigLoading?(d(),u("div",Le,[s(Y,{indeterminate:"",color:"primary"})])):o.newConfigData&&o.newConfigMetadata?(d(),u("div",Ne,[Se,s(_,{metadata:o.newConfigMetadata,config_data:o.newConfigData},null,8,["metadata","config_data"])])):(d(),u("div",We,[s(p,null,{default:a(()=>[f("mdi-information-outline")]),_:1}),Ue]))])):v("",!0)]))])):v("",!0)])])]}),_:1},512),s(B,null,{default:a(()=>[s(x),s(h,{text:"",onClick:n.closeDialog},{default:a(()=>[f(g(l.tm("dialog.cancel")),1)]),_:1},8,["onClick"]),i.updatingMode?(d(),y(h,{key:1,disabled:!o.selectedAbConfId,color:"primary",onClick:n.newPlatform,loading:o.loading},{default:a(()=>[f(g(l.tm("dialog.save")),1)]),_:1},8,["disabled","onClick","loading"])):(d(),y(h,{key:0,disabled:!n.canSave,color:"primary",onClick:n.newPlatform,loading:o.loading},{default:a(()=>[f(g(l.tm("dialog.save")),1)]),_:1},8,["disabled","onClick","loading"]))]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue","onAfterEnter"]),s(T,{modelValue:o.showIdConflictDialog,"onUpdate:modelValue":t[8]||(t[8]=m=>o.showIdConflictDialog=m),"max-width":"450",persistent:""},{default:a(()=>[s(D,null,{default:a(()=>[s(E,{class:"text-h6 bg-warning d-flex align-center"},{default:a(()=>[s(p,{start:"",class:"me-2"},{default:a(()=>[f("mdi-alert-circle-outline")]),_:1}),f(" "+g(l.tm("dialog.idConflict.title")),1)]),_:1}),s(I,{class:"py-4 text-body-1 text-medium-emphasis"},{default:a(()=>[f(g(l.tm("dialog.idConflict.message",{id:o.conflictId})),1)]),_:1}),s(B,null,{default:a(()=>[s(x),s(h,{color:"grey",variant:"text",onClick:t[7]||(t[7]=m=>n.handleIdConflictConfirm(!1))},{default:a(()=>[f(g(l.tm("dialog.idConflict.confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:o.showOneBotEmptyTokenWarnDialog,"onUpdate:modelValue":t[11]||(t[11]=m=>o.showOneBotEmptyTokenWarnDialog=m),"max-width":"600",persistent:""},{default:a(()=>[s(D,null,{default:a(()=>[s(E,null,{default:a(()=>[f(g(l.tm("dialog.securityWarning.title")),1)]),_:1}),s(I,{class:"py-4"},{default:a(()=>[r("p",null,g(l.tm("dialog.securityWarning.aiocqhttpTokenMissing")),1),r("span",null,[r("a",$e,g(l.tm("dialog.securityWarning.learnMore")),1)])]),_:1}),s(B,{class:"px-4 pb-4"},{default:a(()=>[s(x),s(h,{color:"error",onClick:t[9]||(t[9]=m=>n.handleOneBotEmptyTokenWarningDismiss(!0))},{default:a(()=>[f(" 无视警告并继续创建 ")]),_:1}),s(h,{color:"primary",onClick:t[10]||(t[10]=m=>n.handleOneBotEmptyTokenWarningDismiss(!1))},{default:a(()=>[f(" 重新修改 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(K,{modelValue:o.showConfigDrawer,"onUpdate:modelValue":t[12]||(t[12]=m=>o.showConfigDrawer=m),class:"config-drawer-overlay",location:"right",transition:"slide-x-reverse-transition",scrim:!0,"onClick:outside":n.closeConfigDrawer},{default:a(()=>[s(D,{class:"config-drawer-card",elevation:"12"},{default:a(()=>[r("div",et,[r("div",null,[tt,o.configDrawerTargetId?(d(),u("div",ot," ID: "+g(o.configDrawerTargetId),1)):v("",!0)]),s(h,{icon:"",variant:"text",onClick:n.closeConfigDrawer},{default:a(()=>[s(p,null,{default:a(()=>[f("mdi-close")]),_:1})]),_:1},8,["onClick"])]),s(Z),r("div",st,[o.showConfigDrawer?(d(),y(k,{key:0,"initial-config-id":o.configDrawerTargetId},null,8,["initial-config-id"])):v("",!0)])]),_:1})]),_:1},8,["modelValue","onClick:outside"])],64)}const it=G(ce,[["render",at]]);const lt={name:"PlatformPage",components:{AstrBotConfig:U,WaitingForRestart:se,ConsoleDisplayer:ae,ItemCard:ie,AddNewPlatform:it},setup(){const{t:e}=J(),{tm:t}=S("features/platform");return{t:e,tm:t}},computed:{messages(){return{updateSuccess:this.tm("messages.updateSuccess"),addSuccess:this.tm("messages.addSuccess"),deleteSuccess:this.tm("messages.deleteSuccess"),statusUpdateSuccess:this.tm("messages.statusUpdateSuccess"),deleteConfirm:this.tm("messages.deleteConfirm")}}},data(){return{config_data:{},fetched:!1,metadata:{},showAddPlatformDialog:!1,updatingPlatformConfig:{},updatingMode:!1,save_message_snack:!1,save_message:"",save_message_success:"success",showConsole:!1,store:re()}},watch:{showIdConflictDialog(e){!e&&this.idConflictResolve&&(this.idConflictResolve(!1),this.idConflictResolve=null)},showOneBotEmptyTokenWarnDialog(e){!e&&this.oneBotEmptyTokenWarningResolve&&(this.oneBotEmptyTokenWarningResolve(!0),this.oneBotEmptyTokenWarningResolve=null)}},mounted(){this.getConfig()},methods:{getPlatformIcon(e){var i,l,o,n;const t=(n=(o=(l=(i=this.metadata.platform_group)==null?void 0:i.metadata)==null?void 0:l.platform)==null?void 0:o.config_template)==null?void 0:n[e];return t&&t.logo_token?`/api/file/${t.logo_token}`:H(e)},getConfig(){C.get("/api/config/get").then(e=>{this.config_data=e.data.data.config,this.fetched=!0,this.metadata=e.data.data.metadata}).catch(e=>{this.showError(e)})},editPlatform(e){this.updatingPlatformConfig=JSON.parse(JSON.stringify(e)),this.updatingMode=!0,this.showAddPlatformDialog=!0,this.$nextTick(()=>{this.$refs.addPlatformDialog.toggleShowConfigSection()})},deletePlatform(e){confirm(`${this.messages.deleteConfirm} ${e.id}?`)&&C.post("/api/config/platform/delete",{id:e.id}).then(t=>{this.getConfig(),this.showSuccess(t.data.message||this.messages.deleteSuccess)}).catch(t=>{var i,l;this.showError(((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||t.message)})},platformStatusChange(e){e.enable=!e.enable,C.post("/api/config/platform/update",{id:e.id,config:e}).then(t=>{this.getConfig(),this.showSuccess(t.data.message||this.messages.statusUpdateSuccess)}).catch(t=>{var i,l;e.enable=!e.enable,this.showError(((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||t.message)})},showToast({message:e,type:t}){t==="success"?this.showSuccess(e):t==="error"&&this.showError(e)},showSuccess(e){this.save_message=e,this.save_message_success="success",this.save_message_snack=!0},showError(e){this.save_message=e,this.save_message_success="error",this.save_message_snack=!0}}},nt={class:"platform-page"},rt={class:"text-h1 font-weight-bold mb-2 d-flex align-center"},dt={class:"text-subtitle-1 text-medium-emphasis mb-4"},ft={class:"text-grey mt-4"},ct={class:"text-h4"};function gt(e,t,i,l,o,n){const w=b("item-card"),_=b("ConsoleDisplayer"),k=b("AddNewPlatform");return d(),u("div",nt,[s($,{fluid:"",class:"pa-0"},{default:a(()=>[s(M,{class:"d-flex justify-space-between align-center px-4 py-3 pb-8"},{default:a(()=>[r("div",null,[r("h1",rt,[s(p,{color:"black",class:"me-2"},{default:a(()=>[f("mdi-robot")]),_:1}),f(g(l.tm("title")),1)]),r("p",dt,g(l.tm("subtitle")),1)]),s(h,{color:"primary","prepend-icon":"mdi-plus",variant:"tonal",onClick:t[0]||(t[0]=m=>{o.updatingMode=!1,o.showAddPlatformDialog=!0}),rounded:"xl",size:"x-large"},{default:a(()=>[f(g(l.tm("addAdapter")),1)]),_:1})]),_:1}),r("div",null,[(o.config_data.platform||[]).length===0?(d(),y(M,{key:0},{default:a(()=>[s(N,{cols:"12",class:"text-center pa-8"},{default:a(()=>[s(p,{size:"64",color:"grey-lighten-1"},{default:a(()=>[f("mdi-connection")]),_:1}),r("p",ft,g(l.tm("emptyText")),1)]),_:1})]),_:1})):(d(),y(M,{key:1},{default:a(()=>[(d(!0),u(W,null,te(o.config_data.platform||[],(m,P)=>(d(),y(N,{key:P,cols:"12",md:"6",lg:"4",xl:"3"},{default:a(()=>[s(w,{item:m,"title-field":"id","enabled-field":"enable",bglogo:n.getPlatformIcon(m.type||m.id),onToggleEnabled:n.platformStatusChange,onDelete:n.deletePlatform,onEdit:n.editPlatform},null,8,["item","bglogo","onToggleEnabled","onDelete","onEdit"])]),_:2},1024))),128))]),_:1}))]),s(D,{elevation:"0",class:"mt-4"},{default:a(()=>[s(E,{class:"d-flex align-center py-3 px-4"},{default:a(()=>[s(p,{class:"me-2"},{default:a(()=>[f("mdi-console-line")]),_:1}),r("span",ct,g(l.tm("logs.title")),1),s(x),s(h,{variant:"text",color:"primary",onClick:t[1]||(t[1]=m=>o.showConsole=!o.showConsole)},{default:a(()=>[f(g(o.showConsole?l.tm("logs.collapse"):l.tm("logs.expand"))+" ",1),s(p,null,{default:a(()=>[f(g(o.showConsole?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),s(oe,null,{default:a(()=>[o.showConsole?(d(),y(I,{key:0,class:"pa-0"},{default:a(()=>[s(_,{style:{"background-color":"#1e1e1e",height:"300px","border-radius":"0"}})]),_:1})):v("",!0)]),_:1})]),_:1})]),_:1}),s(k,{show:o.showAddPlatformDialog,"onUpdate:show":t[2]||(t[2]=m=>o.showAddPlatformDialog=m),metadata:o.metadata,config_data:o.config_data,ref:"addPlatformDialog","updating-mode":o.updatingMode,"updating-platform-config":o.updatingPlatformConfig,onUpdate:n.getConfig,onShowToast:n.showToast,onRefreshConfig:n.getConfig},null,8,["show","metadata","config_data","updating-mode","updating-platform-config","onUpdate","onShowToast","onRefreshConfig"]),s(ee,{timeout:3e3,elevation:"24",color:o.save_message_success,modelValue:o.save_message_snack,"onUpdate:modelValue":t[3]||(t[3]=m=>o.save_message_snack=m),location:"top"},{default:a(()=>[f(g(o.save_message),1)]),_:1},8,["color","modelValue"])])}const Dt=G(lt,[["render",gt],["__scopeId","data-v-02680935"]]);export{Dt as default};
